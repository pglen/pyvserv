<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>mainwinpeople API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>mainwinpeople</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">#!/usr/bin/env python

import os, sys, getopt, signal, random, time, base64
import string, warnings, uuid, datetime, struct, io

import gi
gi.require_version(&#34;Gtk&#34;, &#34;3.0&#34;)
from gi.repository import Gtk
from gi.repository import Gdk
from gi.repository import GLib
from gi.repository import GObject
from gi.repository import Pango

from pyvguicom import pgutils

# Add this path to find local modules
base = os.path.dirname(pgutils.__file__)
sys.path.append(base)

from pyvguicom import pgbox
from pyvguicom import pgsimp
from pyvguicom import pggui
from pyvguicom import pgentry
from pyvguicom import pgtests

from pymenu import  *
from pgui import  *

import pyvrecsel, pgcal, config, passdlg, pymisc

from pyvcommon import pydata, pyservsup,  pyvhash, crysupp, pyvindex

from pydbase import twincore, twinchain

import pyvpacker

from Crypto.Cipher import AES

# ------------------------------------------------------------------------

class MainWin(Gtk.Window):

    def __init__(self, globals):

        Gtk.Window.__init__(self, Gtk.WindowType.TOPLEVEL)

        #print(&#34;globals&#34;, globals.myhome)
        self.reentry    = False
        self.powers     = 0
        self.conf       = globals.conf
        self.conf.iconf = os.path.dirname(globals.conf.me) + os.sep + &#34;pyvpeople.png&#34;
        self.conf.iconf2 = os.path.dirname(globals.conf.me) + os.sep + &#34;pyvvote_sub.png&#34;
        self.conf.siteid = globals.siteid
        try:
            #print(&#34;iconf&#34;, self.conf.iconf)
            ic = Gtk.Image(); ic.set_from_file(self.conf.iconf)
            self.set_icon(ic.get_pixbuf())
        except:
            pass

        self.start_anal = False
        #self.core = None
        self.cnt = 0
        self.old_sss = 1
        self.set_title(&#34;PyVServer Client Entry&#34;)
        self.set_position(Gtk.WindowPosition.CENTER_ALWAYS)
        self.packer = pyvpacker.packbin()
        self.vcore = twincore.TwinCore(&#34;voters.pydb&#34;, 0)
        self.hcore = twincore.TwinCore(&#34;ihosts.pydb&#34;, 0)
        self.acore = twincore.TwinCore(&#34;audit.pydb&#34;, 0)
        self.authcore = twincore.TwinCore(&#34;auth.pydb&#34;, 0)

        # We let the core carry vars; make sure they do not collide
        self.vcore.packer = self.packer
        self.vcore.hashname  = os.path.splitext(self.vcore.fname)[0] + &#34;.hash.id&#34;
        self.vcore.hashname2 = os.path.splitext(self.vcore.fname)[0] + &#34;.hash.name&#34;
        self.vcore.hashname3 = os.path.splitext(self.vcore.fname)[0] + &#34;.hash.phone&#34;
        self.vcore.hashname4 = os.path.splitext(self.vcore.fname)[0] + &#34;.hash.email&#34;

        self.exit_flag = 0
        self.stop = True

        #ic = Gtk.Image(); ic.set_from_stock(Gtk.STOCK_DIALOG_INFO, Gtk.ICON_SIZE_BUTTON)
        #window.set_icon(ic.get_pixbuf())

        www = Gdk.Screen.width(); hhh = Gdk.Screen.height();

        disp2 = Gdk.Display()
        disp = disp2.get_default()
        #print( disp)
        scr = disp.get_default_screen()
        ptr = disp.get_pointer()
        mon = scr.get_monitor_at_point(ptr[1], ptr[2])
        geo = scr.get_monitor_geometry(mon)
        www = geo.width; hhh = geo.height
        xxx = geo.x;     yyy = geo.y

        # Resort to old means of getting screen w / h
        if www == 0 or hhh == 0:
            www = Gdk.screen_width(); hhh = Gdk.screen_height();

        #self.set_default_size(6*www/8, 6*hhh/8)

        self.dat_dict = {}
        self.dat_dict_org = {}

        #if www / hhh &gt; 2:
        #    self.set_default_size(5*www/8, 5*hhh/8)
        #else:
        #    self.set_default_size(7*www/8, 7*hhh/8)

        self.connect(&#34;delete-event&#34;, self.OnExit)
        self.connect(&#34;destroy&#34;, self.OnExit)
        #self.connect(&#34;key-press-event&#34;, self.key_press_event)
        #self.connect(&#34;button-press-event&#34;, self.button_press_event)

        try:
            self.set_icon_from_file(&#34;icon.png&#34;)
        except:
            pass

        vbox = Gtk.VBox()

        hbox4 = Gtk.HBox()
        #hbox4a = Gtk.HBox()

        lab1 = Gtk.Label(&#34;   &#34;);
        hbox4.pack_start(lab1, 0, 0, 0)
        self.status = pymisc.Status()
        hbox4.pack_start(self.status.scroll, 1, 1, 0)
        lab1 = Gtk.Label(&#34;   &#34;);
        hbox4.pack_start(lab1, 0, 0, 0)

        if globals.conf.testx:
            butt2 = Gtk.Button.new_with_mnemonic(&#34; Te_zt &#34;)
            butt2.connect(&#34;clicked&#34;, self.test_data)
            hbox4.pack_start(butt2, 0, 0, 2)

        butt2a = Gtk.Button.new_with_mnemonic(&#34; Config_ure &#34;)
        butt2a.connect(&#34;clicked&#34;, self.config_dlg)
        hbox4.pack_start(butt2a, False, 0, 2)

        butt2 = Gtk.Button.new_with_mnemonic(&#34; Ne_w &#34;)
        butt2.connect(&#34;clicked&#34;, self.new_data)
        hbox4.pack_start(butt2, False, 0, 2)

        butt2 = Gtk.Button.new_with_mnemonic(&#34; _Delete  &#34;)
        butt2.connect(&#34;clicked&#34;, self.del_data)
        hbox4.pack_start(butt2, False, 0, 2)
        #hbox4.pack_start(Gtk.Label(&#34;   &#34;), 0, 0, 2)

        merge = Gtk.UIManager()
        #self.mywin.set_data(&#34;ui-manager&#34;, merge)

        aa = create_action_group(self)
        merge.insert_action_group(aa, 0)
        self.add_accel_group(merge.get_accel_group())

        merge_id = merge.new_merge_id()

        try:
            mergeid = merge.add_ui_from_string(ui_info)
        except GLib.GError as msg:
            print(&#34;Building menus failed: %s&#34; % msg)

        #self.mbar = merge.get_widget(&#34;/MenuBar&#34;)
        #self.mbar.show()
        #self.tbar = merge.get_widget(&#34;/ToolBar&#34;);
        #self.tbar.show()
        #bbox = Gtk.VBox()
        #bbox.pack_start(self.mbar, 0,0, 0)
        #bbox.pack_start(self.tbar, 0,0, 0)
        #vbox.pack_start(bbox, False, 0, 0)

        butt1 = Gtk.Button.new_with_mnemonic(&#34; _Save  &#34;)
        butt1.connect(&#34;clicked&#34;, self.save_data)
        hbox4.pack_start(butt1, False, 0, 2)

        butt3 = Gtk.Button.new_with_mnemonic(&#34; Lo_ad  &#34;)
        butt3.connect(&#34;clicked&#34;, self.load_data)
        hbox4.pack_start(butt3, False, 0, 2)

        butt2 = Gtk.Button.new_with_mnemonic(&#34;  E_xit  &#34;)
        butt2.connect(&#34;clicked&#34;, self.OnExit, self)
        hbox4.pack_start(butt2, False, 0, 2)

        lab2 = Gtk.Label(&#34;   &#34;);  hbox4.pack_start(lab2, 0, 0, 0)

        gridx = Gtk.Grid()
        gridx.set_column_spacing(6)
        gridx.set_row_spacing(6)

        #gridx.modify_bg(Gtk.StateType.NORMAL, Gdk.color_parse(&#34;#aaaaaa&#34;))

        rowcnt = 0
        sumx = Gtk.HBox()

        # ----------------------------------------------------------------

        buttx2 = Gtk.Button.new_with_mnemonic(&#34;Sele_ct Date&#34;)
        tp1 =(&#34;Full Nam_e: &#34;, &#34;name&#34;, &#34;Enter full name (TAB to advance)&#34;, None)
        tp2 = (&#34;Date o_f birth: &#34;, &#34;dob&#34;, &#34;Date of birth, YYYY/MM/DD&#34;, None)
        lab1, lab2 = pgentry.gridquad(gridx, rowcnt, 0, tp1, tp2, buttx2)
        buttx2.connect(&#34;clicked&#34;, self.pressed_dob, lab2)
        self.dat_dict[&#39;name&#39;] = lab1
        self.dat_dict[&#39;dob&#39;] = lab2
        rowcnt += 1

        tp3 = (&#34;Location of birth: &#34;, &#34;lob&#34;, &#34;Location: City / Country&#34;, None)
        tp4 = (&#34;Nick Name: &#34;, &#34;nick&#34;, &#34;Enter nick name / Alias if available&#34;, None)
        lab3, lab4 = pgentry.gridquad(gridx, 0, rowcnt, tp3, tp4)
        self.dat_dict[&#39;lob&#39;] = lab3
        self.dat_dict[&#39;nick&#39;] = lab4
        rowcnt += 1

        #gridx.attach(pggui.ySpacer(8), 0, rowcnt, 1, 1)
        #rowcnt += 1

        tp3a = (&#34;Address Line _1: &#34;, &#34;addr1&#34;, &#34;Address line one. (Number, Street)&#34;, None)
        tp4a = (&#34;Address Line _2: &#34;, &#34;addr2&#34;, &#34;Address line two. (if applicable)&#34;, None)
        lab5, lab6 = pgentry.gridquad(gridx, 0, rowcnt, tp3a, tp4a)
        self.dat_dict[&#39;addr1&#39;] = lab5
        self.dat_dict[&#39;addr2&#39;] = lab6
        rowcnt += 1

        tp5 = (&#34;City: &#34;, &#34;city&#34;, &#34;City or Township&#34;, None)
        tp6 = (&#34;State / Territory: &#34;, &#34;county&#34;, &#34;State / County / Teritory / Borough&#34;, None)
        lab7, lab8 = pgentry.gridquad(gridx, 0, rowcnt, tp5, tp6)
        self.dat_dict[&#39;city&#39;] = lab7
        self.dat_dict[&#39;terr&#39;] = lab8
        rowcnt += 1

        tp7 = (&#34;Zip: &#34;, &#34;zip&#34;, &#34;Zip code or Postal code&#34;, None)
        tp8 = (&#34;Country: &#34;, &#34;country&#34;, &#34;Country of residence&#34;, None)
        lab9, lab10 = pgentry.gridquad(gridx, 0, rowcnt, tp7, tp8)
        self.dat_dict[&#39;zip&#39;] = lab9
        self.dat_dict[&#39;country&#39;] = lab10
        rowcnt += 1

        tp7a = (&#34;Phone: &#34;, &#34;phone&#34;, &#34;Phone or text number. &#34;, None)
        tp8a = (&#34;Email: &#34;, &#34;email&#34;, &#34;Primary Email&#34;, None)
        lab11, lab12 = pgentry.gridquad(gridx, 0, rowcnt, tp7a, tp8a)
        self.dat_dict[&#39;phone&#39;] = lab11
        self.dat_dict[&#39;email&#39;] = lab12
        rowcnt += 1

        tp7b = (&#34;Phone: (Secondary)&#34;, &#34;phone2&#34;, &#34;Secondary phone or text number. &#34;, None)
        tp8b = (&#34;Email: (Secondary)&#34;, &#34;email2&#34;, &#34;Secondary Email, if available: Ex: whatsapp&#34;, None)
        lab13, lab14 = pgentry.gridquad(gridx, 0, rowcnt, tp7b, tp8b)
        self.dat_dict[&#39;phone2&#39;] = lab13
        self.dat_dict[&#39;email2&#39;] = lab14
        rowcnt += 1

        tp6x = (&#34;_Notes: &#34;, &#34;&#34;, &#34;Text for Notes. Press Shift Enter to advance&#34;, None)
        lab6x = pgentry.gridsingle(gridx, 0, rowcnt, tp6x)
        self.dat_dict[&#39;notes&#39;] = lab6x
        rowcnt += 1

        gridx.attach(pggui.ySpacer(4), 0, rowcnt, 1, 1)
        rowcnt += 1

        tp3x = (&#34;_Voter / Client UUID: &#34;, &#34;uuid&#34;, &#34;Generate Client UID by pressing button&#34;, None)

        butbox = Gtk.HBox()
        butt1 = Gtk.Button.new_with_mnemonic(&#34;Gene_rate&#34;)
        butt2 = Gtk.Button.new_with_mnemonic(&#34;_QR&#34;)
        butbox.pack_start(butt1, 1, 1, 2); butbox.pack_start(butt2, 0, 0, 2)

        lab3x = pgentry.griddouble(gridx, 0, rowcnt, tp3x, butbox)
        butt1.connect(&#34;clicked&#34;, self.load_uuid, lab3x)
        butt2.connect(&#34;clicked&#34;, self.qr_uuid, lab3x)
        self.dat_dict[&#39;uuid&#39;] = lab3x
        rowcnt += 1

        tp4x = (&#34;Site UUID: &#34;, &#34;guid&#34;, &#34;Group / Site UID&#34;, None)
        butt2 = Gtk.Button.new_with_mnemonic(&#34;Load&#34;)
        lab4x = pgentry.griddouble(gridx, 0, rowcnt, tp4x, butt2)
        butt2.connect(&#34;clicked&#34;, self.load_site_uuid, lab4x)
        self.dat_dict[&#39;guid&#39;] = lab4x
        rowcnt += 1

        tp6x = (&#34;Operator UUID: &#34;, &#34;guid&#34;, &#34;Operator UUID&#34;, None)
        butt2 = Gtk.Button.new_with_mnemonic(&#34;Load&#34;)
        lab6x = pgentry.griddouble(gridx, 0, rowcnt, tp6x, butt2)
        butt2.connect(&#34;clicked&#34;, self.load_op_uuid, lab6x)
        self.dat_dict[&#39;ouid&#39;] = lab6x
        rowcnt += 1

        butt2o = Gtk.Button.new_with_mnemonic(&#34;Load&#34;)
        tp9b = (&#34;Now: (date of entry)&#34;,&#34; &#34;,  &#34;Autofilled, date of entry&#34;, None)
        tp10b = (&#34;Operator:&#34;, &#34; &#34;, &#34;Operator, who entered this record.&#34;, None)
        lab15, lab16 = pgentry.gridquad(gridx, 0, rowcnt, tp9b, tp10b, butt2o)
        butt2o.connect(&#34;clicked&#34;, self.load_op_name, lab16, lab15)

        self.dat_dict[&#39;now&#39;] = lab15
        self.dat_dict[&#39;oper&#39;] = lab16
        rowcnt += 1

        gridx.attach(pggui.ySpacer(4), 0, rowcnt, 1, 1)
        rowcnt += 1

        #tp7b = (&#34;Vote:&#34; , &#34;&#34;, &#34;Voting entity. &#34;, None)
        #tp8b = (&#34;Secondary Vote&#34;, &#34;&#34;, &#34;Secondary Entity&#34;, None)
        #lab13, lab14 = gridquad(gridx, 0, rowcnt, tp7b, tp8b, butt)
        #self.dat_dict[&#39;vote&#39;] = lab13
        #self.dat_dict[&#39;vote2&#39;] = lab14
        #rowcnt += 1

        # ----------------------------------------------------------------

        # Create snapshot
        for aa in self.dat_dict.keys():
            self.dat_dict_org[aa] = self.dat_dict[aa].get_text()

        #hboxtop = Gtk.HBox()
        #hboxtop.pack_start(Gtk.Label(&#34; &#34;),  0, 0, 2)
        #hboxtop.pack_start(Gtk.Label(&#34;Not all enrties are required: &#34;),  0, 0, 6)
        #hboxtop.pack_start(Gtk.Label(&#34; &#34;),  1, 1, 2)
        ##hboxtop.modify_bg(Gtk.StateType.NORMAL, Gdk.color_parse(&#34;#aaaa44&#34;))
        #vbox.pack_start(hboxtop, 0, 0, 0)

        #pggui.set_testmode(1)
        vbox.pack_start(pggui.ySpacer(4), 0, 0, 0)

        #sumx.modify_bg(Gtk.StateType.NORMAL, Gdk.color_parse(&#34;#aaaaaa&#34;))
        sumx.pack_start(Gtk.Label(&#34;   &#34;), 0, 0, 0)
        sumx.pack_start(gridx, 1, 1, 0)
        sumx.pack_start(Gtk.Label(&#34;   &#34;), 0, 0, 0)

        #vbox.modify_bg(Gtk.StateType.NORMAL, Gdk.color_parse(&#34;#aaaaff&#34;))

        vbox.pack_start(sumx, 1, 1, 2)
        #sumx.modify_bg(Gtk.StateType.NORMAL, Gdk.color_parse(&#34;#aaaa88&#34;))

        if self.conf.playsound:
            self.conf.playsound.play_sound(&#34;&#34;)

        #vbox.pack_start(hbox4a, False, 0, 2)
        vbox.pack_start(hbox4, False, 0, 2)

        self.add(vbox)
        self.show_all()
        self.en_dis_all(False)

        GLib.timeout_add(100, self.start_pass_dlg, 0)

    def config_dlg(self, arg2):
        #print(&#34;config_dlg&#34;)
        #print(&#34;pass pow:&#34;, self.powers)
        if self.powers != &#34;Yes&#34;:
            pymisc.smessage(&#34;Only Admin can Configure.&#34;)
        else:
            config.ConfigDlg(self.vcore, self.hcore, self.acore, self.authcore, self.conf)

    def start_pass_dlg(self, arg2):

        authcnt = 0
        while True:
            if authcnt &gt; 3:
                pymisc.smessage(&#34;Too May tries, exiting.&#34;)
                sys.exit(1)
            ret = passdlg.auth_initial(self.authcore, self.packer, self.conf)

            #print(&#34;ret:&#34;, ret)

            if not ret[0]:
                authcnt += 1
                continue

            if ret[1][2] != &#34;Enabled&#34;:
                authcnt += 1
                msg = &#34;Cannot log in, user &#39;%s&#39; is disbled &#34; % ret[1][0]
                self.status.set_status_text(msg)
                pymisc.smessage(msg)
                continue

            # Success
            self.operator = ret[1][0]
            self.powers   = ret[1][4]
            self.ouid     = ret[1][5]
            #print(&#34;pow&#34;, self.powers, self.operator, self.ouid)
            self.status.set_status_text(&#34;Authenticated &#39;%s&#39;&#34; % ret[1][0])
            self.en_dis_all(True)
            pyvrecsel.audit(self.acore, self.packer, &#34;Successful Login&#34;, ret[1][0])
            break
        self.set_focus(self.dat_dict[&#39;name&#39;])

    def en_dis_all(self, flag):

        for aa in self.dat_dict.keys():
            self.dat_dict[aa].set_sensitive(flag)

    def is_changed(self):
        ccc = False
        for aa in self.dat_dict.keys():
            if self.dat_dict_org[aa] != self.dat_dict[aa].get_text():
                ccc = True
        return ccc

    def pressed_dob(self, arg, arg2):
        #arg2.set_text(&#34;Developing&#34;)

        dd = datetime.datetime.now()

        org = arg2.get_text().split(&#34;/&#34;)
        #print(&#34;org:&#34;, org)

        if len(org) == 0:
            org.append(dd.year)
            org.append(dd.month)
            org.append(dd.day)
        elif len(org) == 1:
            if not org[0]:
                org[0] = dd.year
            org.append(dd.month)
            org.append(dd.day)

        result = pgcal.PopCal(org)

        if result[0] != Gtk.ResponseType.ACCEPT:
            return
        #print(&#34;res:&#34;, result)

        #result[1][1] += 1

        arg2.set_text(str(result[1][0]) + &#34;/&#34; + str(result[1][1]) + \
                            &#34;/&#34; + str(result[1][2]))

    def load_op_name(self, arg, arg2, arg3):
        if arg2.get_text() != &#34;&#34;:
            msg = &#34;Already has operator; Cannot set.&#34;
            pymisc.smessage(msg)
            self.status.set_status_text(msg)
            return
        arg2.set_text(self.operator)
        #if arg3.get_text() == &#34;&#34;:
        dd = datetime.datetime.now()
        dd = dd.replace(microsecond=0)
        arg3.set_text(dd.isoformat())

    def qr_uuid(self, arg, arg2):
        uuu = arg2.get_text()
        if not uuu:
            msg = &#34;Please generate UUID first.&#34;
            pymisc.smessage(msg)
            self.status.set_status_text(msg)
            return
        nnn = self.dat_dict[&#39;name&#39;].get_text() + &#34; -- &#34; + \
                self.dat_dict[&#39;dob&#39;].get_text()

        ret = pymisc.QrDlg(uuu, nnn, self.conf, parent = self)

    def load_uuid(self, arg, arg2):

        if arg2.get_text() != &#34;&#34;:
            msg = &#34;Already has a UUID; Cannot set.&#34;
            pymisc.smessage(msg)
            self.status.set_status_text(msg)
            return

        if not self.dat_dict[&#39;name&#39;].get_text():
            msg = &#34;Must have a FULL name.&#34;
            self.status.set_status_text(msg)
            self.set_focus(self.dat_dict[&#39;name&#39;])
            pymisc.smessage(msg)
            return

        arg2.set_text(str(uuid.uuid1()))

    def load_op_uuid(self, arg, arg2):
        if arg2.get_text() != &#34;&#34;:
            msg = &#34;Already has a OUID; Cannot set.&#34;
            pymisc.smessage(msg)
            self.status.set_status_text(msg)
            return
        arg2.set_text(self.ouid)

    def load_site_uuid(self, arg, arg2):
        if arg2.get_text() != &#34;&#34;:
            msg = &#34;Already has a Site UUID; Cannot set.&#34;
            pymisc.smessage(msg)
            self.status.set_status_text(msg)
            return
        arg2.set_text(str(self.conf.siteid))

    def cellx(self, idx):
        cell = Gtk.CellRendererText()

        #if centered[idx]:
        #    cell.set_property(&#34;alignment&#34;, Pango.Alignment.CENTER)
        #    cell.set_property(&#34;align-set&#34;, True)
        #    cell.set_alignment(0.5, 0.)

        #cell.connect(&#34;edited&#34;, self.text_edited, idx)
        self.cells.append(cell)
        return cell

    def sel_last(self, treex):
        #print(&#34;sel last ...&#34;)
        sel = treex.get_selection()
        xmodel, xiter = sel.get_selected()
        iter = xmodel.get_iter_first()
        if not iter:
            return
        while True:
            iter2 = xmodel.iter_next(iter)
            if not iter2:
                break
            iter = iter2.copy()
        sel.select_iter(iter)
        ppp = xmodel.get_path(iter)
        treex.set_cursor(ppp, self.tree1.get_column(0), False)
        pgutils.usleep(5)
        treex.scroll_to_cell(ppp, None, True, 0., 0. )
        #sel.select_path(self.treestore.get_path(iter))

    def wrap(self, cont):
        fr = Gtk.Frame()
        sc = Gtk.ScrolledWindow()
        sc.set_hexpand(True)
        sc.set_vexpand(True)
        sc.add(cont)
        fr.add(sc)
        return fr, cont

    def  non_changed(self):

        &#39;&#39;&#39; Mark as non changed &#39;&#39;&#39;
        for aa in self.dat_dict.keys():
            self.dat_dict_org[aa] = self.dat_dict[aa].get_text()

    def  clear_data(self):

        &#39;&#39;&#39; Clar out data &#39;&#39;&#39;

        for aa in self.dat_dict.keys():
            self.dat_dict[aa].set_text(&#34;&#34;)

    def  reset_changed(self):

        &#39;&#39;&#39; Reset flags for changed dict &#39;&#39;&#39;

        for aa in self.dat_dict.keys():
            self.dat_dict_org[aa] = self.dat_dict[aa].get_text()

    def del_data(self, arg):

        &#39;&#39;&#39; Delete currently active data &#39;&#39;&#39;

        nnn = self.dat_dict[&#39;name&#39;].get_text()
        if not nnn:
            msg = &#34;Empty record, cannot delete.&#34;
            self.status.set_status_text(msg)
            pymisc.smessage(msg)
            return
        msg = &#34;This will delete: &#39;%s&#39;&#34; % nnn
        self.status.set_status_text(msg)
        msg += &#34;\nAre you sure?&#34;
        ret = pggui.yes_no(msg, default=&#34;No&#34;)
        if ret != Gtk.ResponseType.YES:
            return True
        ddd = self.dat_dict[&#39;uuid&#39;].get_text()
        # Find it via index
        ddd2 = pyvindex.search_index(ddd, self.vcore, self.vcore.hashname, pyvindex.hash_id, &#34;&#34;)
        for aa in ddd2:
            #print(&#34;deleting:&#34;, ddd2)
            try:
                rrr = self.vcore.get_rec(aa)
                ret = self.vcore.del_rec(aa)
                #print(aa, &#34;del ret:&#34;, ret)
                dec = self.packer.decode_data(rrr[1])[0]
                pyvrecsel.audit(self.acore, self.packer, &#34;Deleted Record&#34;, dec)
                self.status.set_status_text(&#34;Record &#39;%s&#39; deleted.&#34; % nnn)
            except:
                print(sys.exc_info())

        # Clear, reset
        self.clear_data()
        self.reset_changed()

    def new_data(self, arg):

        # See if previous one saved
        ccc = False
        for aa in self.dat_dict.keys():
            if self.dat_dict_org[aa] != self.dat_dict[aa].get_text():
                ccc = True
        if ccc:
            msg = &#34;Unsaved data. Are you sure you want to abandon it for new record?&#34;
            self.status.set_status_text(msg)
            ret = pggui.yes_no(msg, default=&#34;No&#34;)
            if ret != Gtk.ResponseType.YES:
                return True

        # Clear, reset
        for aa in self.dat_dict.keys():
            self.dat_dict[aa].set_text(&#34;&#34;)

        # Fill in defaults
        dd = datetime.datetime.now()
        dd = dd.replace(microsecond=0)
        #self.dat_dict[&#39;uuid&#39;].set_text(str(uuid.uuid1()))
        self.dat_dict[&#39;now&#39;].set_text(dd.isoformat())
        self.dat_dict[&#39;guid&#39;].set_text(str(self.conf.siteid))
        self.dat_dict[&#39;ouid&#39;].set_text(str(self.ouid))
        self.dat_dict[&#39;oper&#39;].set_text(str(self.operator))

        self.reset_changed()
        self.set_focus(self.dat_dict[&#39;name&#39;])

    def load_data(self, arg):

        # See if previous one saved
        ccc = False
        for aa in self.dat_dict.keys():
            if self.dat_dict_org[aa] != self.dat_dict[aa].get_text():
                ccc = True
        if ccc:
            msg = &#34;Please save data before loading a new record.\n&#34; \
                  &#34;Current changes would be discarded. Are you sure?&#34;
            self.status.set_status_text(msg)
            ret = pggui.yes_no(msg, default=&#34;No&#34;)
            if ret != Gtk.ResponseType.YES:
                return

        # Clear, reset
        for aa in self.dat_dict.keys():
            self.dat_dict[aa].set_text(&#34;&#34;)
        self.reset_changed()

        self.conf.acore = self.acore
        sss = pyvrecsel.RecSelDlg(self.vcore, self.conf, mode=pyvrecsel.MODE_VOTER)
        if sss.response != Gtk.ResponseType.ACCEPT:
            return
        #print(&#34;sss.res:&#34;, sss.res)
        try:
            # Slow ...
            #dat = self.vcore.retrieve(sss.res[0][3])
            # New data: abs. position added
            #print(&#34;get_rec&#34;, int(sss.res[0][4]))
            dat = self.vcore.get_rec(int(sss.res[0][4]))
        except:
            dat = []
            print(sys.exc_info())
            pass
        if not dat:
            msg = &#34;No data selected.&#34;
            #print(msg)
            self.status.set_status_text(msg)
            pymisc.smessage(msg)
            return
        #print(&#34;dat:&#34;, dat)
        try:
            # dec array[0] if retrieve
            #dec = self.packer.decode_data(dat[1])[0]
            # dec array if get_rec
            dec = self.packer.decode_data(dat[1])[0][&#39;PayLoad&#39;]
        except:
            dec = {}
            pass
        #print(&#34;dec:&#34;, dec)
        for aa in dec.keys():
            try:
                self.dat_dict[aa].set_text(dec[aa])
            except:
                pass

        # Mark as non changed
        self.reset_changed()

    def test_data(self, arg1):

        self.conf.playsound = None
        #print(&#34;test started&#34;)
        self.stop = not self.stop

        if self.reentry:
            self.usleep(100)
            return

        self.reentry = True
        while True:
            if self.exit_flag:
                self.reset_changed()
                break
            if self.stop:
                self.reset_changed()
                self.status.set_status_text(&#34;Test Stopped&#34;)
                break
            for aa in self.dat_dict.keys():
                # Handle differences
                if aa == &#39;uuid&#39;:
                   self.dat_dict[aa].set_text(str(uuid.uuid1()) )
                elif aa == &#39;name&#39;:
                   self.dat_dict[aa].set_text(pgtests.simname(random.randint(12, 22)))
                elif aa == &#39;guid&#39;:
                   self.dat_dict[aa].set_text(str(uuid.uuid1()) )
                elif aa == &#39;dob&#39;:
                    self.dat_dict[aa].set_text(pgtests.randate())
                elif aa == &#39;addr1&#39;:
                    self.dat_dict[aa].set_text(pgtests.simaddr(18))
                elif aa == &#39;addr2&#39;:
                    self.dat_dict[aa].set_text(pgtests.simaddr(12))
                elif aa == &#39;phone&#39;:
                    self.dat_dict[aa].set_text(pgtests.randphone())
                elif aa == &#39;phone2&#39;:
                    self.dat_dict[aa].set_text(pgtests.randphone())
                elif aa == &#39;email&#39;:
                    self.dat_dict[aa].set_text(pgtests.randemail())
                elif aa == &#39;email2&#39;:
                    self.dat_dict[aa].set_text(pgtests.randemail())
                elif aa == &#39;zip&#39;:
                    self.dat_dict[aa].set_text(pgtests.randnumstr(5))
                elif aa == &#39;now&#39;:
                    self.dat_dict[aa].set_text(pgtests.randisodate())
                elif aa == &#39;notes&#39;:
                    self.dat_dict[aa].set_text(pgtests.randascii(random.randint(33, 66)))
                else:
                    self.dat_dict[aa].set_text(pgtests.randstr(random.randint(6, 22)))
            sleepx = 20
            pgutils.usleep(sleepx)
            self.save_data(0)
            self.clear_data()
            pgutils.usleep(sleepx)
        self.reentry = False


    def autofill(self, idxname, newid):
        try:
            uuu = uuid.UUID(self.dat_dict[idxname].get_text())
        except:
            self.dat_dict[idxname].set_text(str(newid))

    def save_data(self, arg1):

        # See if changed
        if not self.is_changed():
            msg = &#34;Nothing changed, cannot save.&#34;
            self.status.set_status_text(msg)
            pymisc.smessage(msg)
            return

        if not self.dat_dict[&#39;name&#39;].get_text():
            msg = &#34;Must have a FULL name.&#34;
            self.status.set_status_text(msg)
            self.set_focus(self.dat_dict[&#39;name&#39;])
            pymisc.smessage(msg)
            return

        dob = self.dat_dict[&#39;dob&#39;].get_text()
        if not dob or len(dob.split(&#34;/&#34;)) &lt; 3:
            msg = &#34;Must have a valid Client date of birth. (yyyy/mm/dd)&#34;
            self.status.set_status_text(msg)
            self.set_focus(self.dat_dict[&#39;dob&#39;])
            pymisc.smessage(msg)
            return

        # Commemorate event by setting a fresh date
        #if  self.dat_dict[&#39;now&#39;].get_text() == &#34;&#34;:
        dd = datetime.datetime.now().replace(microsecond=0)
        self.dat_dict[&#39;now&#39;].set_text(dd.isoformat())

        # This we can generate, but the user better know about it
        # Wed 01.May.2024 Auto generated
        self.autofill(&#39;uuid&#39;, uuid.uuid1())

        # Autofill what we can
        self.autofill(&#39;guid&#39;, self.conf.siteid)
        self.autofill(&#39;ouid&#39;, self.ouid)
        self.autofill(&#39;oper&#39;, self.operator)

        ddd = {}
        for aa in self.dat_dict.keys():
            ddd[aa] = self.dat_dict[aa].get_text()

        pvh = pyvhash.BcData()
        # We mark this as &#39;test&#39; so it can stay in the chain, if desired
        #pvh.addpayload({&#34;Test&#34;: &#34;test&#34; ,})
        pvh.addpayload(ddd)

        def callbdlg(dlg):
            #print(&#34;callback from dlg&#34;)
            self.status.set_status_text(&#34;PROW calc, please wait ...&#34;)
            ddd = 15
            for aa in range(ddd):
                dlg.prog.set_fraction((aa+1) * 1/ddd)
                if pvh.powarr():
                    break
                self.status.set_status_text(&#34;PROW calc retry %d ..&#34; % (aa+1))
            dlg.response(Gtk.ResponseType.ACCEPT)
            dlg.destroy()
            self.status.set_status_text(&#34;PROW done.&#34;)

        if self.conf.weak:
            pvh.num_zeros = 1
        dlg = pymisc.progDlg(self.conf, callbdlg, parent = self)

        if not pvh.checkpow():
            msg = &#34;Cold not generate PROW, please retry saving record.&#34;
            pymisc.smessage(msg, conf=self.conf, sound=&#34;error&#34;)
            return

        #print(&#34;Save_data&#34;, pvh.datax)

        enc = self.packer.encode_data(&#34;&#34;, pvh.datax)
        #print(&#34;enc:&#34;, enc)
        uuu = self.dat_dict[&#39;uuid&#39;].get_text()

        # Add index
        def callb(c2, id2):
            # Replicate fields from local data
            dddd = [uuu, enc.encode()]
            #print(&#34;dddd:&#34;, dddd)
            try:
                pyvindex.append_index(c2, self.vcore.hashname,  pyvindex.hash_id, dddd)
            except:
                print(&#34;exc save callb hash&#34;, sys.exc_info())
            try:
                pyvindex.append_index(c2, self.vcore.hashname2, pyvindex.hash_name, dddd)
            except:
                print(&#34;exc save callb name&#34;, sys.exc_info())
                #pgutils.put_exception(&#34;save idx&#34;)
            try:
                pyvindex.append_index(c2, self.vcore.hashname3, pyvindex.hash_email, dddd)
            except:
                print(&#34;exc save callb name&#34;, sys.exc_info())

            try:
                pyvindex.append_index(c2, self.vcore.hashname4, pyvindex.hash_phone, dddd)
            except:
                print(&#34;exc save callb name&#34;, sys.exc_info())

        try:
            self.vcore.postexec = callb
            ret = self.vcore.save_data(uuu, enc)
        except:
            pass
            print(&#34;save&#34;, sys.exc_info())
        finally:
            self.vcore.postexec = None

        if self.conf.playsound:
            self.conf.playsound.play_sound(&#34;shutter&#34;)

        self.status.set_status_text(&#34;Entry &#39;%s&#39; saved.&#34; % self.dat_dict[&#39;name&#39;].get_text())

        for aa in self.dat_dict.keys():
            self.dat_dict_org[aa] = self.dat_dict[aa].get_text()

    def main(self):
        Gtk.main()

    def  OnExit(self, arg, srg2 = None):

        self.stop = True
        self.exit_flag = True

        ccc = False
        for aa in self.dat_dict.keys():
            if self.dat_dict_org[aa] != self.dat_dict[aa].get_text():
                ccc = True
        if ccc:
            msg = &#34;Unsaved data. Are you sure you want to abandon it?&#34;
            self.status.set_status_text(msg)
            self.status_cnt = 4
            ret = pggui.yes_no(msg, default=&#34;No&#34;)
            #print(&#34;yes_no:&#34;, ret)
            if ret != Gtk.ResponseType.YES:
                return True
            else:
                #print(&#34;Abandoning&#34;, self.dat_dict[&#39;name&#39;].get_text())
                pass

        self.exit_all()

    def exit_all(self):
        self.exit_flag = 1
        Gtk.main_quit()

    def key_press_event(self, win, event):
        #print( &#34;key_press_event&#34;, event.string, event.state)
        pass

    def button_press_event(self, win, event):
        #print( &#34;button_press_event&#34;, win, event)
        pass

    def activate_action(self, action):

        warnings.simplefilter(&#34;ignore&#34;)
        strx = action.get_name()
        warnings.simplefilter(&#34;default&#34;)

        print (&#34;activate_action&#34;, strx)

    def activate_quit(self, action):
        print( &#34;activate_quit called&#34;)
        self.OnExit(False)

    def activate_exit(self, action):
        print( &#34;activate_exit called&#34; )
        self.OnExit(False)

    def activate_about(self, action):
        print( &#34;activate_about called&#34;)
        pass

# Start of program:

if __name__ == &#39;__main__&#39;:

    mainwin = MainWin()
    Gtk.main()

# EOF</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="mainwinpeople.MainWin"><code class="flex name class">
<span>class <span class="ident">MainWin</span></span>
<span>(</span><span>globals)</span>
</code></dt>
<dd>
<div class="desc"><p>:Constructors:</p>
<p>::</p>
<pre><code>Window(**properties)
new(type:Gtk.WindowType) -&gt; Gtk.Widget
</code></pre></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class MainWin(Gtk.Window):

    def __init__(self, globals):

        Gtk.Window.__init__(self, Gtk.WindowType.TOPLEVEL)

        #print(&#34;globals&#34;, globals.myhome)
        self.reentry    = False
        self.powers     = 0
        self.conf       = globals.conf
        self.conf.iconf = os.path.dirname(globals.conf.me) + os.sep + &#34;pyvpeople.png&#34;
        self.conf.iconf2 = os.path.dirname(globals.conf.me) + os.sep + &#34;pyvvote_sub.png&#34;
        self.conf.siteid = globals.siteid
        try:
            #print(&#34;iconf&#34;, self.conf.iconf)
            ic = Gtk.Image(); ic.set_from_file(self.conf.iconf)
            self.set_icon(ic.get_pixbuf())
        except:
            pass

        self.start_anal = False
        #self.core = None
        self.cnt = 0
        self.old_sss = 1
        self.set_title(&#34;PyVServer Client Entry&#34;)
        self.set_position(Gtk.WindowPosition.CENTER_ALWAYS)
        self.packer = pyvpacker.packbin()
        self.vcore = twincore.TwinCore(&#34;voters.pydb&#34;, 0)
        self.hcore = twincore.TwinCore(&#34;ihosts.pydb&#34;, 0)
        self.acore = twincore.TwinCore(&#34;audit.pydb&#34;, 0)
        self.authcore = twincore.TwinCore(&#34;auth.pydb&#34;, 0)

        # We let the core carry vars; make sure they do not collide
        self.vcore.packer = self.packer
        self.vcore.hashname  = os.path.splitext(self.vcore.fname)[0] + &#34;.hash.id&#34;
        self.vcore.hashname2 = os.path.splitext(self.vcore.fname)[0] + &#34;.hash.name&#34;
        self.vcore.hashname3 = os.path.splitext(self.vcore.fname)[0] + &#34;.hash.phone&#34;
        self.vcore.hashname4 = os.path.splitext(self.vcore.fname)[0] + &#34;.hash.email&#34;

        self.exit_flag = 0
        self.stop = True

        #ic = Gtk.Image(); ic.set_from_stock(Gtk.STOCK_DIALOG_INFO, Gtk.ICON_SIZE_BUTTON)
        #window.set_icon(ic.get_pixbuf())

        www = Gdk.Screen.width(); hhh = Gdk.Screen.height();

        disp2 = Gdk.Display()
        disp = disp2.get_default()
        #print( disp)
        scr = disp.get_default_screen()
        ptr = disp.get_pointer()
        mon = scr.get_monitor_at_point(ptr[1], ptr[2])
        geo = scr.get_monitor_geometry(mon)
        www = geo.width; hhh = geo.height
        xxx = geo.x;     yyy = geo.y

        # Resort to old means of getting screen w / h
        if www == 0 or hhh == 0:
            www = Gdk.screen_width(); hhh = Gdk.screen_height();

        #self.set_default_size(6*www/8, 6*hhh/8)

        self.dat_dict = {}
        self.dat_dict_org = {}

        #if www / hhh &gt; 2:
        #    self.set_default_size(5*www/8, 5*hhh/8)
        #else:
        #    self.set_default_size(7*www/8, 7*hhh/8)

        self.connect(&#34;delete-event&#34;, self.OnExit)
        self.connect(&#34;destroy&#34;, self.OnExit)
        #self.connect(&#34;key-press-event&#34;, self.key_press_event)
        #self.connect(&#34;button-press-event&#34;, self.button_press_event)

        try:
            self.set_icon_from_file(&#34;icon.png&#34;)
        except:
            pass

        vbox = Gtk.VBox()

        hbox4 = Gtk.HBox()
        #hbox4a = Gtk.HBox()

        lab1 = Gtk.Label(&#34;   &#34;);
        hbox4.pack_start(lab1, 0, 0, 0)
        self.status = pymisc.Status()
        hbox4.pack_start(self.status.scroll, 1, 1, 0)
        lab1 = Gtk.Label(&#34;   &#34;);
        hbox4.pack_start(lab1, 0, 0, 0)

        if globals.conf.testx:
            butt2 = Gtk.Button.new_with_mnemonic(&#34; Te_zt &#34;)
            butt2.connect(&#34;clicked&#34;, self.test_data)
            hbox4.pack_start(butt2, 0, 0, 2)

        butt2a = Gtk.Button.new_with_mnemonic(&#34; Config_ure &#34;)
        butt2a.connect(&#34;clicked&#34;, self.config_dlg)
        hbox4.pack_start(butt2a, False, 0, 2)

        butt2 = Gtk.Button.new_with_mnemonic(&#34; Ne_w &#34;)
        butt2.connect(&#34;clicked&#34;, self.new_data)
        hbox4.pack_start(butt2, False, 0, 2)

        butt2 = Gtk.Button.new_with_mnemonic(&#34; _Delete  &#34;)
        butt2.connect(&#34;clicked&#34;, self.del_data)
        hbox4.pack_start(butt2, False, 0, 2)
        #hbox4.pack_start(Gtk.Label(&#34;   &#34;), 0, 0, 2)

        merge = Gtk.UIManager()
        #self.mywin.set_data(&#34;ui-manager&#34;, merge)

        aa = create_action_group(self)
        merge.insert_action_group(aa, 0)
        self.add_accel_group(merge.get_accel_group())

        merge_id = merge.new_merge_id()

        try:
            mergeid = merge.add_ui_from_string(ui_info)
        except GLib.GError as msg:
            print(&#34;Building menus failed: %s&#34; % msg)

        #self.mbar = merge.get_widget(&#34;/MenuBar&#34;)
        #self.mbar.show()
        #self.tbar = merge.get_widget(&#34;/ToolBar&#34;);
        #self.tbar.show()
        #bbox = Gtk.VBox()
        #bbox.pack_start(self.mbar, 0,0, 0)
        #bbox.pack_start(self.tbar, 0,0, 0)
        #vbox.pack_start(bbox, False, 0, 0)

        butt1 = Gtk.Button.new_with_mnemonic(&#34; _Save  &#34;)
        butt1.connect(&#34;clicked&#34;, self.save_data)
        hbox4.pack_start(butt1, False, 0, 2)

        butt3 = Gtk.Button.new_with_mnemonic(&#34; Lo_ad  &#34;)
        butt3.connect(&#34;clicked&#34;, self.load_data)
        hbox4.pack_start(butt3, False, 0, 2)

        butt2 = Gtk.Button.new_with_mnemonic(&#34;  E_xit  &#34;)
        butt2.connect(&#34;clicked&#34;, self.OnExit, self)
        hbox4.pack_start(butt2, False, 0, 2)

        lab2 = Gtk.Label(&#34;   &#34;);  hbox4.pack_start(lab2, 0, 0, 0)

        gridx = Gtk.Grid()
        gridx.set_column_spacing(6)
        gridx.set_row_spacing(6)

        #gridx.modify_bg(Gtk.StateType.NORMAL, Gdk.color_parse(&#34;#aaaaaa&#34;))

        rowcnt = 0
        sumx = Gtk.HBox()

        # ----------------------------------------------------------------

        buttx2 = Gtk.Button.new_with_mnemonic(&#34;Sele_ct Date&#34;)
        tp1 =(&#34;Full Nam_e: &#34;, &#34;name&#34;, &#34;Enter full name (TAB to advance)&#34;, None)
        tp2 = (&#34;Date o_f birth: &#34;, &#34;dob&#34;, &#34;Date of birth, YYYY/MM/DD&#34;, None)
        lab1, lab2 = pgentry.gridquad(gridx, rowcnt, 0, tp1, tp2, buttx2)
        buttx2.connect(&#34;clicked&#34;, self.pressed_dob, lab2)
        self.dat_dict[&#39;name&#39;] = lab1
        self.dat_dict[&#39;dob&#39;] = lab2
        rowcnt += 1

        tp3 = (&#34;Location of birth: &#34;, &#34;lob&#34;, &#34;Location: City / Country&#34;, None)
        tp4 = (&#34;Nick Name: &#34;, &#34;nick&#34;, &#34;Enter nick name / Alias if available&#34;, None)
        lab3, lab4 = pgentry.gridquad(gridx, 0, rowcnt, tp3, tp4)
        self.dat_dict[&#39;lob&#39;] = lab3
        self.dat_dict[&#39;nick&#39;] = lab4
        rowcnt += 1

        #gridx.attach(pggui.ySpacer(8), 0, rowcnt, 1, 1)
        #rowcnt += 1

        tp3a = (&#34;Address Line _1: &#34;, &#34;addr1&#34;, &#34;Address line one. (Number, Street)&#34;, None)
        tp4a = (&#34;Address Line _2: &#34;, &#34;addr2&#34;, &#34;Address line two. (if applicable)&#34;, None)
        lab5, lab6 = pgentry.gridquad(gridx, 0, rowcnt, tp3a, tp4a)
        self.dat_dict[&#39;addr1&#39;] = lab5
        self.dat_dict[&#39;addr2&#39;] = lab6
        rowcnt += 1

        tp5 = (&#34;City: &#34;, &#34;city&#34;, &#34;City or Township&#34;, None)
        tp6 = (&#34;State / Territory: &#34;, &#34;county&#34;, &#34;State / County / Teritory / Borough&#34;, None)
        lab7, lab8 = pgentry.gridquad(gridx, 0, rowcnt, tp5, tp6)
        self.dat_dict[&#39;city&#39;] = lab7
        self.dat_dict[&#39;terr&#39;] = lab8
        rowcnt += 1

        tp7 = (&#34;Zip: &#34;, &#34;zip&#34;, &#34;Zip code or Postal code&#34;, None)
        tp8 = (&#34;Country: &#34;, &#34;country&#34;, &#34;Country of residence&#34;, None)
        lab9, lab10 = pgentry.gridquad(gridx, 0, rowcnt, tp7, tp8)
        self.dat_dict[&#39;zip&#39;] = lab9
        self.dat_dict[&#39;country&#39;] = lab10
        rowcnt += 1

        tp7a = (&#34;Phone: &#34;, &#34;phone&#34;, &#34;Phone or text number. &#34;, None)
        tp8a = (&#34;Email: &#34;, &#34;email&#34;, &#34;Primary Email&#34;, None)
        lab11, lab12 = pgentry.gridquad(gridx, 0, rowcnt, tp7a, tp8a)
        self.dat_dict[&#39;phone&#39;] = lab11
        self.dat_dict[&#39;email&#39;] = lab12
        rowcnt += 1

        tp7b = (&#34;Phone: (Secondary)&#34;, &#34;phone2&#34;, &#34;Secondary phone or text number. &#34;, None)
        tp8b = (&#34;Email: (Secondary)&#34;, &#34;email2&#34;, &#34;Secondary Email, if available: Ex: whatsapp&#34;, None)
        lab13, lab14 = pgentry.gridquad(gridx, 0, rowcnt, tp7b, tp8b)
        self.dat_dict[&#39;phone2&#39;] = lab13
        self.dat_dict[&#39;email2&#39;] = lab14
        rowcnt += 1

        tp6x = (&#34;_Notes: &#34;, &#34;&#34;, &#34;Text for Notes. Press Shift Enter to advance&#34;, None)
        lab6x = pgentry.gridsingle(gridx, 0, rowcnt, tp6x)
        self.dat_dict[&#39;notes&#39;] = lab6x
        rowcnt += 1

        gridx.attach(pggui.ySpacer(4), 0, rowcnt, 1, 1)
        rowcnt += 1

        tp3x = (&#34;_Voter / Client UUID: &#34;, &#34;uuid&#34;, &#34;Generate Client UID by pressing button&#34;, None)

        butbox = Gtk.HBox()
        butt1 = Gtk.Button.new_with_mnemonic(&#34;Gene_rate&#34;)
        butt2 = Gtk.Button.new_with_mnemonic(&#34;_QR&#34;)
        butbox.pack_start(butt1, 1, 1, 2); butbox.pack_start(butt2, 0, 0, 2)

        lab3x = pgentry.griddouble(gridx, 0, rowcnt, tp3x, butbox)
        butt1.connect(&#34;clicked&#34;, self.load_uuid, lab3x)
        butt2.connect(&#34;clicked&#34;, self.qr_uuid, lab3x)
        self.dat_dict[&#39;uuid&#39;] = lab3x
        rowcnt += 1

        tp4x = (&#34;Site UUID: &#34;, &#34;guid&#34;, &#34;Group / Site UID&#34;, None)
        butt2 = Gtk.Button.new_with_mnemonic(&#34;Load&#34;)
        lab4x = pgentry.griddouble(gridx, 0, rowcnt, tp4x, butt2)
        butt2.connect(&#34;clicked&#34;, self.load_site_uuid, lab4x)
        self.dat_dict[&#39;guid&#39;] = lab4x
        rowcnt += 1

        tp6x = (&#34;Operator UUID: &#34;, &#34;guid&#34;, &#34;Operator UUID&#34;, None)
        butt2 = Gtk.Button.new_with_mnemonic(&#34;Load&#34;)
        lab6x = pgentry.griddouble(gridx, 0, rowcnt, tp6x, butt2)
        butt2.connect(&#34;clicked&#34;, self.load_op_uuid, lab6x)
        self.dat_dict[&#39;ouid&#39;] = lab6x
        rowcnt += 1

        butt2o = Gtk.Button.new_with_mnemonic(&#34;Load&#34;)
        tp9b = (&#34;Now: (date of entry)&#34;,&#34; &#34;,  &#34;Autofilled, date of entry&#34;, None)
        tp10b = (&#34;Operator:&#34;, &#34; &#34;, &#34;Operator, who entered this record.&#34;, None)
        lab15, lab16 = pgentry.gridquad(gridx, 0, rowcnt, tp9b, tp10b, butt2o)
        butt2o.connect(&#34;clicked&#34;, self.load_op_name, lab16, lab15)

        self.dat_dict[&#39;now&#39;] = lab15
        self.dat_dict[&#39;oper&#39;] = lab16
        rowcnt += 1

        gridx.attach(pggui.ySpacer(4), 0, rowcnt, 1, 1)
        rowcnt += 1

        #tp7b = (&#34;Vote:&#34; , &#34;&#34;, &#34;Voting entity. &#34;, None)
        #tp8b = (&#34;Secondary Vote&#34;, &#34;&#34;, &#34;Secondary Entity&#34;, None)
        #lab13, lab14 = gridquad(gridx, 0, rowcnt, tp7b, tp8b, butt)
        #self.dat_dict[&#39;vote&#39;] = lab13
        #self.dat_dict[&#39;vote2&#39;] = lab14
        #rowcnt += 1

        # ----------------------------------------------------------------

        # Create snapshot
        for aa in self.dat_dict.keys():
            self.dat_dict_org[aa] = self.dat_dict[aa].get_text()

        #hboxtop = Gtk.HBox()
        #hboxtop.pack_start(Gtk.Label(&#34; &#34;),  0, 0, 2)
        #hboxtop.pack_start(Gtk.Label(&#34;Not all enrties are required: &#34;),  0, 0, 6)
        #hboxtop.pack_start(Gtk.Label(&#34; &#34;),  1, 1, 2)
        ##hboxtop.modify_bg(Gtk.StateType.NORMAL, Gdk.color_parse(&#34;#aaaa44&#34;))
        #vbox.pack_start(hboxtop, 0, 0, 0)

        #pggui.set_testmode(1)
        vbox.pack_start(pggui.ySpacer(4), 0, 0, 0)

        #sumx.modify_bg(Gtk.StateType.NORMAL, Gdk.color_parse(&#34;#aaaaaa&#34;))
        sumx.pack_start(Gtk.Label(&#34;   &#34;), 0, 0, 0)
        sumx.pack_start(gridx, 1, 1, 0)
        sumx.pack_start(Gtk.Label(&#34;   &#34;), 0, 0, 0)

        #vbox.modify_bg(Gtk.StateType.NORMAL, Gdk.color_parse(&#34;#aaaaff&#34;))

        vbox.pack_start(sumx, 1, 1, 2)
        #sumx.modify_bg(Gtk.StateType.NORMAL, Gdk.color_parse(&#34;#aaaa88&#34;))

        if self.conf.playsound:
            self.conf.playsound.play_sound(&#34;&#34;)

        #vbox.pack_start(hbox4a, False, 0, 2)
        vbox.pack_start(hbox4, False, 0, 2)

        self.add(vbox)
        self.show_all()
        self.en_dis_all(False)

        GLib.timeout_add(100, self.start_pass_dlg, 0)

    def config_dlg(self, arg2):
        #print(&#34;config_dlg&#34;)
        #print(&#34;pass pow:&#34;, self.powers)
        if self.powers != &#34;Yes&#34;:
            pymisc.smessage(&#34;Only Admin can Configure.&#34;)
        else:
            config.ConfigDlg(self.vcore, self.hcore, self.acore, self.authcore, self.conf)

    def start_pass_dlg(self, arg2):

        authcnt = 0
        while True:
            if authcnt &gt; 3:
                pymisc.smessage(&#34;Too May tries, exiting.&#34;)
                sys.exit(1)
            ret = passdlg.auth_initial(self.authcore, self.packer, self.conf)

            #print(&#34;ret:&#34;, ret)

            if not ret[0]:
                authcnt += 1
                continue

            if ret[1][2] != &#34;Enabled&#34;:
                authcnt += 1
                msg = &#34;Cannot log in, user &#39;%s&#39; is disbled &#34; % ret[1][0]
                self.status.set_status_text(msg)
                pymisc.smessage(msg)
                continue

            # Success
            self.operator = ret[1][0]
            self.powers   = ret[1][4]
            self.ouid     = ret[1][5]
            #print(&#34;pow&#34;, self.powers, self.operator, self.ouid)
            self.status.set_status_text(&#34;Authenticated &#39;%s&#39;&#34; % ret[1][0])
            self.en_dis_all(True)
            pyvrecsel.audit(self.acore, self.packer, &#34;Successful Login&#34;, ret[1][0])
            break
        self.set_focus(self.dat_dict[&#39;name&#39;])

    def en_dis_all(self, flag):

        for aa in self.dat_dict.keys():
            self.dat_dict[aa].set_sensitive(flag)

    def is_changed(self):
        ccc = False
        for aa in self.dat_dict.keys():
            if self.dat_dict_org[aa] != self.dat_dict[aa].get_text():
                ccc = True
        return ccc

    def pressed_dob(self, arg, arg2):
        #arg2.set_text(&#34;Developing&#34;)

        dd = datetime.datetime.now()

        org = arg2.get_text().split(&#34;/&#34;)
        #print(&#34;org:&#34;, org)

        if len(org) == 0:
            org.append(dd.year)
            org.append(dd.month)
            org.append(dd.day)
        elif len(org) == 1:
            if not org[0]:
                org[0] = dd.year
            org.append(dd.month)
            org.append(dd.day)

        result = pgcal.PopCal(org)

        if result[0] != Gtk.ResponseType.ACCEPT:
            return
        #print(&#34;res:&#34;, result)

        #result[1][1] += 1

        arg2.set_text(str(result[1][0]) + &#34;/&#34; + str(result[1][1]) + \
                            &#34;/&#34; + str(result[1][2]))

    def load_op_name(self, arg, arg2, arg3):
        if arg2.get_text() != &#34;&#34;:
            msg = &#34;Already has operator; Cannot set.&#34;
            pymisc.smessage(msg)
            self.status.set_status_text(msg)
            return
        arg2.set_text(self.operator)
        #if arg3.get_text() == &#34;&#34;:
        dd = datetime.datetime.now()
        dd = dd.replace(microsecond=0)
        arg3.set_text(dd.isoformat())

    def qr_uuid(self, arg, arg2):
        uuu = arg2.get_text()
        if not uuu:
            msg = &#34;Please generate UUID first.&#34;
            pymisc.smessage(msg)
            self.status.set_status_text(msg)
            return
        nnn = self.dat_dict[&#39;name&#39;].get_text() + &#34; -- &#34; + \
                self.dat_dict[&#39;dob&#39;].get_text()

        ret = pymisc.QrDlg(uuu, nnn, self.conf, parent = self)

    def load_uuid(self, arg, arg2):

        if arg2.get_text() != &#34;&#34;:
            msg = &#34;Already has a UUID; Cannot set.&#34;
            pymisc.smessage(msg)
            self.status.set_status_text(msg)
            return

        if not self.dat_dict[&#39;name&#39;].get_text():
            msg = &#34;Must have a FULL name.&#34;
            self.status.set_status_text(msg)
            self.set_focus(self.dat_dict[&#39;name&#39;])
            pymisc.smessage(msg)
            return

        arg2.set_text(str(uuid.uuid1()))

    def load_op_uuid(self, arg, arg2):
        if arg2.get_text() != &#34;&#34;:
            msg = &#34;Already has a OUID; Cannot set.&#34;
            pymisc.smessage(msg)
            self.status.set_status_text(msg)
            return
        arg2.set_text(self.ouid)

    def load_site_uuid(self, arg, arg2):
        if arg2.get_text() != &#34;&#34;:
            msg = &#34;Already has a Site UUID; Cannot set.&#34;
            pymisc.smessage(msg)
            self.status.set_status_text(msg)
            return
        arg2.set_text(str(self.conf.siteid))

    def cellx(self, idx):
        cell = Gtk.CellRendererText()

        #if centered[idx]:
        #    cell.set_property(&#34;alignment&#34;, Pango.Alignment.CENTER)
        #    cell.set_property(&#34;align-set&#34;, True)
        #    cell.set_alignment(0.5, 0.)

        #cell.connect(&#34;edited&#34;, self.text_edited, idx)
        self.cells.append(cell)
        return cell

    def sel_last(self, treex):
        #print(&#34;sel last ...&#34;)
        sel = treex.get_selection()
        xmodel, xiter = sel.get_selected()
        iter = xmodel.get_iter_first()
        if not iter:
            return
        while True:
            iter2 = xmodel.iter_next(iter)
            if not iter2:
                break
            iter = iter2.copy()
        sel.select_iter(iter)
        ppp = xmodel.get_path(iter)
        treex.set_cursor(ppp, self.tree1.get_column(0), False)
        pgutils.usleep(5)
        treex.scroll_to_cell(ppp, None, True, 0., 0. )
        #sel.select_path(self.treestore.get_path(iter))

    def wrap(self, cont):
        fr = Gtk.Frame()
        sc = Gtk.ScrolledWindow()
        sc.set_hexpand(True)
        sc.set_vexpand(True)
        sc.add(cont)
        fr.add(sc)
        return fr, cont

    def  non_changed(self):

        &#39;&#39;&#39; Mark as non changed &#39;&#39;&#39;
        for aa in self.dat_dict.keys():
            self.dat_dict_org[aa] = self.dat_dict[aa].get_text()

    def  clear_data(self):

        &#39;&#39;&#39; Clar out data &#39;&#39;&#39;

        for aa in self.dat_dict.keys():
            self.dat_dict[aa].set_text(&#34;&#34;)

    def  reset_changed(self):

        &#39;&#39;&#39; Reset flags for changed dict &#39;&#39;&#39;

        for aa in self.dat_dict.keys():
            self.dat_dict_org[aa] = self.dat_dict[aa].get_text()

    def del_data(self, arg):

        &#39;&#39;&#39; Delete currently active data &#39;&#39;&#39;

        nnn = self.dat_dict[&#39;name&#39;].get_text()
        if not nnn:
            msg = &#34;Empty record, cannot delete.&#34;
            self.status.set_status_text(msg)
            pymisc.smessage(msg)
            return
        msg = &#34;This will delete: &#39;%s&#39;&#34; % nnn
        self.status.set_status_text(msg)
        msg += &#34;\nAre you sure?&#34;
        ret = pggui.yes_no(msg, default=&#34;No&#34;)
        if ret != Gtk.ResponseType.YES:
            return True
        ddd = self.dat_dict[&#39;uuid&#39;].get_text()
        # Find it via index
        ddd2 = pyvindex.search_index(ddd, self.vcore, self.vcore.hashname, pyvindex.hash_id, &#34;&#34;)
        for aa in ddd2:
            #print(&#34;deleting:&#34;, ddd2)
            try:
                rrr = self.vcore.get_rec(aa)
                ret = self.vcore.del_rec(aa)
                #print(aa, &#34;del ret:&#34;, ret)
                dec = self.packer.decode_data(rrr[1])[0]
                pyvrecsel.audit(self.acore, self.packer, &#34;Deleted Record&#34;, dec)
                self.status.set_status_text(&#34;Record &#39;%s&#39; deleted.&#34; % nnn)
            except:
                print(sys.exc_info())

        # Clear, reset
        self.clear_data()
        self.reset_changed()

    def new_data(self, arg):

        # See if previous one saved
        ccc = False
        for aa in self.dat_dict.keys():
            if self.dat_dict_org[aa] != self.dat_dict[aa].get_text():
                ccc = True
        if ccc:
            msg = &#34;Unsaved data. Are you sure you want to abandon it for new record?&#34;
            self.status.set_status_text(msg)
            ret = pggui.yes_no(msg, default=&#34;No&#34;)
            if ret != Gtk.ResponseType.YES:
                return True

        # Clear, reset
        for aa in self.dat_dict.keys():
            self.dat_dict[aa].set_text(&#34;&#34;)

        # Fill in defaults
        dd = datetime.datetime.now()
        dd = dd.replace(microsecond=0)
        #self.dat_dict[&#39;uuid&#39;].set_text(str(uuid.uuid1()))
        self.dat_dict[&#39;now&#39;].set_text(dd.isoformat())
        self.dat_dict[&#39;guid&#39;].set_text(str(self.conf.siteid))
        self.dat_dict[&#39;ouid&#39;].set_text(str(self.ouid))
        self.dat_dict[&#39;oper&#39;].set_text(str(self.operator))

        self.reset_changed()
        self.set_focus(self.dat_dict[&#39;name&#39;])

    def load_data(self, arg):

        # See if previous one saved
        ccc = False
        for aa in self.dat_dict.keys():
            if self.dat_dict_org[aa] != self.dat_dict[aa].get_text():
                ccc = True
        if ccc:
            msg = &#34;Please save data before loading a new record.\n&#34; \
                  &#34;Current changes would be discarded. Are you sure?&#34;
            self.status.set_status_text(msg)
            ret = pggui.yes_no(msg, default=&#34;No&#34;)
            if ret != Gtk.ResponseType.YES:
                return

        # Clear, reset
        for aa in self.dat_dict.keys():
            self.dat_dict[aa].set_text(&#34;&#34;)
        self.reset_changed()

        self.conf.acore = self.acore
        sss = pyvrecsel.RecSelDlg(self.vcore, self.conf, mode=pyvrecsel.MODE_VOTER)
        if sss.response != Gtk.ResponseType.ACCEPT:
            return
        #print(&#34;sss.res:&#34;, sss.res)
        try:
            # Slow ...
            #dat = self.vcore.retrieve(sss.res[0][3])
            # New data: abs. position added
            #print(&#34;get_rec&#34;, int(sss.res[0][4]))
            dat = self.vcore.get_rec(int(sss.res[0][4]))
        except:
            dat = []
            print(sys.exc_info())
            pass
        if not dat:
            msg = &#34;No data selected.&#34;
            #print(msg)
            self.status.set_status_text(msg)
            pymisc.smessage(msg)
            return
        #print(&#34;dat:&#34;, dat)
        try:
            # dec array[0] if retrieve
            #dec = self.packer.decode_data(dat[1])[0]
            # dec array if get_rec
            dec = self.packer.decode_data(dat[1])[0][&#39;PayLoad&#39;]
        except:
            dec = {}
            pass
        #print(&#34;dec:&#34;, dec)
        for aa in dec.keys():
            try:
                self.dat_dict[aa].set_text(dec[aa])
            except:
                pass

        # Mark as non changed
        self.reset_changed()

    def test_data(self, arg1):

        self.conf.playsound = None
        #print(&#34;test started&#34;)
        self.stop = not self.stop

        if self.reentry:
            self.usleep(100)
            return

        self.reentry = True
        while True:
            if self.exit_flag:
                self.reset_changed()
                break
            if self.stop:
                self.reset_changed()
                self.status.set_status_text(&#34;Test Stopped&#34;)
                break
            for aa in self.dat_dict.keys():
                # Handle differences
                if aa == &#39;uuid&#39;:
                   self.dat_dict[aa].set_text(str(uuid.uuid1()) )
                elif aa == &#39;name&#39;:
                   self.dat_dict[aa].set_text(pgtests.simname(random.randint(12, 22)))
                elif aa == &#39;guid&#39;:
                   self.dat_dict[aa].set_text(str(uuid.uuid1()) )
                elif aa == &#39;dob&#39;:
                    self.dat_dict[aa].set_text(pgtests.randate())
                elif aa == &#39;addr1&#39;:
                    self.dat_dict[aa].set_text(pgtests.simaddr(18))
                elif aa == &#39;addr2&#39;:
                    self.dat_dict[aa].set_text(pgtests.simaddr(12))
                elif aa == &#39;phone&#39;:
                    self.dat_dict[aa].set_text(pgtests.randphone())
                elif aa == &#39;phone2&#39;:
                    self.dat_dict[aa].set_text(pgtests.randphone())
                elif aa == &#39;email&#39;:
                    self.dat_dict[aa].set_text(pgtests.randemail())
                elif aa == &#39;email2&#39;:
                    self.dat_dict[aa].set_text(pgtests.randemail())
                elif aa == &#39;zip&#39;:
                    self.dat_dict[aa].set_text(pgtests.randnumstr(5))
                elif aa == &#39;now&#39;:
                    self.dat_dict[aa].set_text(pgtests.randisodate())
                elif aa == &#39;notes&#39;:
                    self.dat_dict[aa].set_text(pgtests.randascii(random.randint(33, 66)))
                else:
                    self.dat_dict[aa].set_text(pgtests.randstr(random.randint(6, 22)))
            sleepx = 20
            pgutils.usleep(sleepx)
            self.save_data(0)
            self.clear_data()
            pgutils.usleep(sleepx)
        self.reentry = False


    def autofill(self, idxname, newid):
        try:
            uuu = uuid.UUID(self.dat_dict[idxname].get_text())
        except:
            self.dat_dict[idxname].set_text(str(newid))

    def save_data(self, arg1):

        # See if changed
        if not self.is_changed():
            msg = &#34;Nothing changed, cannot save.&#34;
            self.status.set_status_text(msg)
            pymisc.smessage(msg)
            return

        if not self.dat_dict[&#39;name&#39;].get_text():
            msg = &#34;Must have a FULL name.&#34;
            self.status.set_status_text(msg)
            self.set_focus(self.dat_dict[&#39;name&#39;])
            pymisc.smessage(msg)
            return

        dob = self.dat_dict[&#39;dob&#39;].get_text()
        if not dob or len(dob.split(&#34;/&#34;)) &lt; 3:
            msg = &#34;Must have a valid Client date of birth. (yyyy/mm/dd)&#34;
            self.status.set_status_text(msg)
            self.set_focus(self.dat_dict[&#39;dob&#39;])
            pymisc.smessage(msg)
            return

        # Commemorate event by setting a fresh date
        #if  self.dat_dict[&#39;now&#39;].get_text() == &#34;&#34;:
        dd = datetime.datetime.now().replace(microsecond=0)
        self.dat_dict[&#39;now&#39;].set_text(dd.isoformat())

        # This we can generate, but the user better know about it
        # Wed 01.May.2024 Auto generated
        self.autofill(&#39;uuid&#39;, uuid.uuid1())

        # Autofill what we can
        self.autofill(&#39;guid&#39;, self.conf.siteid)
        self.autofill(&#39;ouid&#39;, self.ouid)
        self.autofill(&#39;oper&#39;, self.operator)

        ddd = {}
        for aa in self.dat_dict.keys():
            ddd[aa] = self.dat_dict[aa].get_text()

        pvh = pyvhash.BcData()
        # We mark this as &#39;test&#39; so it can stay in the chain, if desired
        #pvh.addpayload({&#34;Test&#34;: &#34;test&#34; ,})
        pvh.addpayload(ddd)

        def callbdlg(dlg):
            #print(&#34;callback from dlg&#34;)
            self.status.set_status_text(&#34;PROW calc, please wait ...&#34;)
            ddd = 15
            for aa in range(ddd):
                dlg.prog.set_fraction((aa+1) * 1/ddd)
                if pvh.powarr():
                    break
                self.status.set_status_text(&#34;PROW calc retry %d ..&#34; % (aa+1))
            dlg.response(Gtk.ResponseType.ACCEPT)
            dlg.destroy()
            self.status.set_status_text(&#34;PROW done.&#34;)

        if self.conf.weak:
            pvh.num_zeros = 1
        dlg = pymisc.progDlg(self.conf, callbdlg, parent = self)

        if not pvh.checkpow():
            msg = &#34;Cold not generate PROW, please retry saving record.&#34;
            pymisc.smessage(msg, conf=self.conf, sound=&#34;error&#34;)
            return

        #print(&#34;Save_data&#34;, pvh.datax)

        enc = self.packer.encode_data(&#34;&#34;, pvh.datax)
        #print(&#34;enc:&#34;, enc)
        uuu = self.dat_dict[&#39;uuid&#39;].get_text()

        # Add index
        def callb(c2, id2):
            # Replicate fields from local data
            dddd = [uuu, enc.encode()]
            #print(&#34;dddd:&#34;, dddd)
            try:
                pyvindex.append_index(c2, self.vcore.hashname,  pyvindex.hash_id, dddd)
            except:
                print(&#34;exc save callb hash&#34;, sys.exc_info())
            try:
                pyvindex.append_index(c2, self.vcore.hashname2, pyvindex.hash_name, dddd)
            except:
                print(&#34;exc save callb name&#34;, sys.exc_info())
                #pgutils.put_exception(&#34;save idx&#34;)
            try:
                pyvindex.append_index(c2, self.vcore.hashname3, pyvindex.hash_email, dddd)
            except:
                print(&#34;exc save callb name&#34;, sys.exc_info())

            try:
                pyvindex.append_index(c2, self.vcore.hashname4, pyvindex.hash_phone, dddd)
            except:
                print(&#34;exc save callb name&#34;, sys.exc_info())

        try:
            self.vcore.postexec = callb
            ret = self.vcore.save_data(uuu, enc)
        except:
            pass
            print(&#34;save&#34;, sys.exc_info())
        finally:
            self.vcore.postexec = None

        if self.conf.playsound:
            self.conf.playsound.play_sound(&#34;shutter&#34;)

        self.status.set_status_text(&#34;Entry &#39;%s&#39; saved.&#34; % self.dat_dict[&#39;name&#39;].get_text())

        for aa in self.dat_dict.keys():
            self.dat_dict_org[aa] = self.dat_dict[aa].get_text()

    def main(self):
        Gtk.main()

    def  OnExit(self, arg, srg2 = None):

        self.stop = True
        self.exit_flag = True

        ccc = False
        for aa in self.dat_dict.keys():
            if self.dat_dict_org[aa] != self.dat_dict[aa].get_text():
                ccc = True
        if ccc:
            msg = &#34;Unsaved data. Are you sure you want to abandon it?&#34;
            self.status.set_status_text(msg)
            self.status_cnt = 4
            ret = pggui.yes_no(msg, default=&#34;No&#34;)
            #print(&#34;yes_no:&#34;, ret)
            if ret != Gtk.ResponseType.YES:
                return True
            else:
                #print(&#34;Abandoning&#34;, self.dat_dict[&#39;name&#39;].get_text())
                pass

        self.exit_all()

    def exit_all(self):
        self.exit_flag = 1
        Gtk.main_quit()

    def key_press_event(self, win, event):
        #print( &#34;key_press_event&#34;, event.string, event.state)
        pass

    def button_press_event(self, win, event):
        #print( &#34;button_press_event&#34;, win, event)
        pass

    def activate_action(self, action):

        warnings.simplefilter(&#34;ignore&#34;)
        strx = action.get_name()
        warnings.simplefilter(&#34;default&#34;)

        print (&#34;activate_action&#34;, strx)

    def activate_quit(self, action):
        print( &#34;activate_quit called&#34;)
        self.OnExit(False)

    def activate_exit(self, action):
        print( &#34;activate_exit called&#34; )
        self.OnExit(False)

    def activate_about(self, action):
        print( &#34;activate_about called&#34;)
        pass</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>gi.overrides.Gtk.Window</li>
<li>gi.repository.Gtk.Window</li>
<li>gi.repository.Gtk.Bin</li>
<li>gi.overrides.Gtk.Container</li>
<li>gi.repository.Gtk.Container</li>
<li>gi.overrides.Gtk.Widget</li>
<li>gi.repository.Gtk.Widget</li>
<li>gi.repository.GObject.InitiallyUnowned</li>
<li>gi.overrides.GObject.Object</li>
<li>gi.repository.GObject.Object</li>
<li>gi._gi.GObject</li>
<li>gi.repository.Atk.ImplementorIface</li>
<li>gi.repository.Gtk.Buildable</li>
<li>gobject.GInterface</li>
</ul>
<h3>Methods</h3>
<dl>
<dt id="mainwinpeople.MainWin.OnExit"><code class="name flex">
<span>def <span class="ident">OnExit</span></span>(<span>self, arg, srg2=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  OnExit(self, arg, srg2 = None):

    self.stop = True
    self.exit_flag = True

    ccc = False
    for aa in self.dat_dict.keys():
        if self.dat_dict_org[aa] != self.dat_dict[aa].get_text():
            ccc = True
    if ccc:
        msg = &#34;Unsaved data. Are you sure you want to abandon it?&#34;
        self.status.set_status_text(msg)
        self.status_cnt = 4
        ret = pggui.yes_no(msg, default=&#34;No&#34;)
        #print(&#34;yes_no:&#34;, ret)
        if ret != Gtk.ResponseType.YES:
            return True
        else:
            #print(&#34;Abandoning&#34;, self.dat_dict[&#39;name&#39;].get_text())
            pass

    self.exit_all()</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.activate_about"><code class="name flex">
<span>def <span class="ident">activate_about</span></span>(<span>self, action)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def activate_about(self, action):
    print( &#34;activate_about called&#34;)
    pass</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.activate_action"><code class="name flex">
<span>def <span class="ident">activate_action</span></span>(<span>self, action)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def activate_action(self, action):

    warnings.simplefilter(&#34;ignore&#34;)
    strx = action.get_name()
    warnings.simplefilter(&#34;default&#34;)

    print (&#34;activate_action&#34;, strx)</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.activate_exit"><code class="name flex">
<span>def <span class="ident">activate_exit</span></span>(<span>self, action)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def activate_exit(self, action):
    print( &#34;activate_exit called&#34; )
    self.OnExit(False)</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.activate_quit"><code class="name flex">
<span>def <span class="ident">activate_quit</span></span>(<span>self, action)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def activate_quit(self, action):
    print( &#34;activate_quit called&#34;)
    self.OnExit(False)</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.autofill"><code class="name flex">
<span>def <span class="ident">autofill</span></span>(<span>self, idxname, newid)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def autofill(self, idxname, newid):
    try:
        uuu = uuid.UUID(self.dat_dict[idxname].get_text())
    except:
        self.dat_dict[idxname].set_text(str(newid))</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.button_press_event"><code class="name flex">
<span>def <span class="ident">button_press_event</span></span>(<span>self, win, event)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def button_press_event(self, win, event):
    #print( &#34;button_press_event&#34;, win, event)
    pass</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.cellx"><code class="name flex">
<span>def <span class="ident">cellx</span></span>(<span>self, idx)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def cellx(self, idx):
    cell = Gtk.CellRendererText()

    #if centered[idx]:
    #    cell.set_property(&#34;alignment&#34;, Pango.Alignment.CENTER)
    #    cell.set_property(&#34;align-set&#34;, True)
    #    cell.set_alignment(0.5, 0.)

    #cell.connect(&#34;edited&#34;, self.text_edited, idx)
    self.cells.append(cell)
    return cell</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.clear_data"><code class="name flex">
<span>def <span class="ident">clear_data</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Clar out data</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  clear_data(self):

    &#39;&#39;&#39; Clar out data &#39;&#39;&#39;

    for aa in self.dat_dict.keys():
        self.dat_dict[aa].set_text(&#34;&#34;)</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.config_dlg"><code class="name flex">
<span>def <span class="ident">config_dlg</span></span>(<span>self, arg2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def config_dlg(self, arg2):
    #print(&#34;config_dlg&#34;)
    #print(&#34;pass pow:&#34;, self.powers)
    if self.powers != &#34;Yes&#34;:
        pymisc.smessage(&#34;Only Admin can Configure.&#34;)
    else:
        config.ConfigDlg(self.vcore, self.hcore, self.acore, self.authcore, self.conf)</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.del_data"><code class="name flex">
<span>def <span class="ident">del_data</span></span>(<span>self, arg)</span>
</code></dt>
<dd>
<div class="desc"><p>Delete currently active data</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def del_data(self, arg):

    &#39;&#39;&#39; Delete currently active data &#39;&#39;&#39;

    nnn = self.dat_dict[&#39;name&#39;].get_text()
    if not nnn:
        msg = &#34;Empty record, cannot delete.&#34;
        self.status.set_status_text(msg)
        pymisc.smessage(msg)
        return
    msg = &#34;This will delete: &#39;%s&#39;&#34; % nnn
    self.status.set_status_text(msg)
    msg += &#34;\nAre you sure?&#34;
    ret = pggui.yes_no(msg, default=&#34;No&#34;)
    if ret != Gtk.ResponseType.YES:
        return True
    ddd = self.dat_dict[&#39;uuid&#39;].get_text()
    # Find it via index
    ddd2 = pyvindex.search_index(ddd, self.vcore, self.vcore.hashname, pyvindex.hash_id, &#34;&#34;)
    for aa in ddd2:
        #print(&#34;deleting:&#34;, ddd2)
        try:
            rrr = self.vcore.get_rec(aa)
            ret = self.vcore.del_rec(aa)
            #print(aa, &#34;del ret:&#34;, ret)
            dec = self.packer.decode_data(rrr[1])[0]
            pyvrecsel.audit(self.acore, self.packer, &#34;Deleted Record&#34;, dec)
            self.status.set_status_text(&#34;Record &#39;%s&#39; deleted.&#34; % nnn)
        except:
            print(sys.exc_info())

    # Clear, reset
    self.clear_data()
    self.reset_changed()</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.en_dis_all"><code class="name flex">
<span>def <span class="ident">en_dis_all</span></span>(<span>self, flag)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def en_dis_all(self, flag):

    for aa in self.dat_dict.keys():
        self.dat_dict[aa].set_sensitive(flag)</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.exit_all"><code class="name flex">
<span>def <span class="ident">exit_all</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def exit_all(self):
    self.exit_flag = 1
    Gtk.main_quit()</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.is_changed"><code class="name flex">
<span>def <span class="ident">is_changed</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def is_changed(self):
    ccc = False
    for aa in self.dat_dict.keys():
        if self.dat_dict_org[aa] != self.dat_dict[aa].get_text():
            ccc = True
    return ccc</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.key_press_event"><code class="name flex">
<span>def <span class="ident">key_press_event</span></span>(<span>self, win, event)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def key_press_event(self, win, event):
    #print( &#34;key_press_event&#34;, event.string, event.state)
    pass</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.load_data"><code class="name flex">
<span>def <span class="ident">load_data</span></span>(<span>self, arg)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def load_data(self, arg):

    # See if previous one saved
    ccc = False
    for aa in self.dat_dict.keys():
        if self.dat_dict_org[aa] != self.dat_dict[aa].get_text():
            ccc = True
    if ccc:
        msg = &#34;Please save data before loading a new record.\n&#34; \
              &#34;Current changes would be discarded. Are you sure?&#34;
        self.status.set_status_text(msg)
        ret = pggui.yes_no(msg, default=&#34;No&#34;)
        if ret != Gtk.ResponseType.YES:
            return

    # Clear, reset
    for aa in self.dat_dict.keys():
        self.dat_dict[aa].set_text(&#34;&#34;)
    self.reset_changed()

    self.conf.acore = self.acore
    sss = pyvrecsel.RecSelDlg(self.vcore, self.conf, mode=pyvrecsel.MODE_VOTER)
    if sss.response != Gtk.ResponseType.ACCEPT:
        return
    #print(&#34;sss.res:&#34;, sss.res)
    try:
        # Slow ...
        #dat = self.vcore.retrieve(sss.res[0][3])
        # New data: abs. position added
        #print(&#34;get_rec&#34;, int(sss.res[0][4]))
        dat = self.vcore.get_rec(int(sss.res[0][4]))
    except:
        dat = []
        print(sys.exc_info())
        pass
    if not dat:
        msg = &#34;No data selected.&#34;
        #print(msg)
        self.status.set_status_text(msg)
        pymisc.smessage(msg)
        return
    #print(&#34;dat:&#34;, dat)
    try:
        # dec array[0] if retrieve
        #dec = self.packer.decode_data(dat[1])[0]
        # dec array if get_rec
        dec = self.packer.decode_data(dat[1])[0][&#39;PayLoad&#39;]
    except:
        dec = {}
        pass
    #print(&#34;dec:&#34;, dec)
    for aa in dec.keys():
        try:
            self.dat_dict[aa].set_text(dec[aa])
        except:
            pass

    # Mark as non changed
    self.reset_changed()</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.load_op_name"><code class="name flex">
<span>def <span class="ident">load_op_name</span></span>(<span>self, arg, arg2, arg3)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def load_op_name(self, arg, arg2, arg3):
    if arg2.get_text() != &#34;&#34;:
        msg = &#34;Already has operator; Cannot set.&#34;
        pymisc.smessage(msg)
        self.status.set_status_text(msg)
        return
    arg2.set_text(self.operator)
    #if arg3.get_text() == &#34;&#34;:
    dd = datetime.datetime.now()
    dd = dd.replace(microsecond=0)
    arg3.set_text(dd.isoformat())</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.load_op_uuid"><code class="name flex">
<span>def <span class="ident">load_op_uuid</span></span>(<span>self, arg, arg2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def load_op_uuid(self, arg, arg2):
    if arg2.get_text() != &#34;&#34;:
        msg = &#34;Already has a OUID; Cannot set.&#34;
        pymisc.smessage(msg)
        self.status.set_status_text(msg)
        return
    arg2.set_text(self.ouid)</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.load_site_uuid"><code class="name flex">
<span>def <span class="ident">load_site_uuid</span></span>(<span>self, arg, arg2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def load_site_uuid(self, arg, arg2):
    if arg2.get_text() != &#34;&#34;:
        msg = &#34;Already has a Site UUID; Cannot set.&#34;
        pymisc.smessage(msg)
        self.status.set_status_text(msg)
        return
    arg2.set_text(str(self.conf.siteid))</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.load_uuid"><code class="name flex">
<span>def <span class="ident">load_uuid</span></span>(<span>self, arg, arg2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def load_uuid(self, arg, arg2):

    if arg2.get_text() != &#34;&#34;:
        msg = &#34;Already has a UUID; Cannot set.&#34;
        pymisc.smessage(msg)
        self.status.set_status_text(msg)
        return

    if not self.dat_dict[&#39;name&#39;].get_text():
        msg = &#34;Must have a FULL name.&#34;
        self.status.set_status_text(msg)
        self.set_focus(self.dat_dict[&#39;name&#39;])
        pymisc.smessage(msg)
        return

    arg2.set_text(str(uuid.uuid1()))</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.main"><code class="name flex">
<span>def <span class="ident">main</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def main(self):
    Gtk.main()</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.new_data"><code class="name flex">
<span>def <span class="ident">new_data</span></span>(<span>self, arg)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def new_data(self, arg):

    # See if previous one saved
    ccc = False
    for aa in self.dat_dict.keys():
        if self.dat_dict_org[aa] != self.dat_dict[aa].get_text():
            ccc = True
    if ccc:
        msg = &#34;Unsaved data. Are you sure you want to abandon it for new record?&#34;
        self.status.set_status_text(msg)
        ret = pggui.yes_no(msg, default=&#34;No&#34;)
        if ret != Gtk.ResponseType.YES:
            return True

    # Clear, reset
    for aa in self.dat_dict.keys():
        self.dat_dict[aa].set_text(&#34;&#34;)

    # Fill in defaults
    dd = datetime.datetime.now()
    dd = dd.replace(microsecond=0)
    #self.dat_dict[&#39;uuid&#39;].set_text(str(uuid.uuid1()))
    self.dat_dict[&#39;now&#39;].set_text(dd.isoformat())
    self.dat_dict[&#39;guid&#39;].set_text(str(self.conf.siteid))
    self.dat_dict[&#39;ouid&#39;].set_text(str(self.ouid))
    self.dat_dict[&#39;oper&#39;].set_text(str(self.operator))

    self.reset_changed()
    self.set_focus(self.dat_dict[&#39;name&#39;])</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.non_changed"><code class="name flex">
<span>def <span class="ident">non_changed</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Mark as non changed</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  non_changed(self):

    &#39;&#39;&#39; Mark as non changed &#39;&#39;&#39;
    for aa in self.dat_dict.keys():
        self.dat_dict_org[aa] = self.dat_dict[aa].get_text()</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.pressed_dob"><code class="name flex">
<span>def <span class="ident">pressed_dob</span></span>(<span>self, arg, arg2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def pressed_dob(self, arg, arg2):
    #arg2.set_text(&#34;Developing&#34;)

    dd = datetime.datetime.now()

    org = arg2.get_text().split(&#34;/&#34;)
    #print(&#34;org:&#34;, org)

    if len(org) == 0:
        org.append(dd.year)
        org.append(dd.month)
        org.append(dd.day)
    elif len(org) == 1:
        if not org[0]:
            org[0] = dd.year
        org.append(dd.month)
        org.append(dd.day)

    result = pgcal.PopCal(org)

    if result[0] != Gtk.ResponseType.ACCEPT:
        return
    #print(&#34;res:&#34;, result)

    #result[1][1] += 1

    arg2.set_text(str(result[1][0]) + &#34;/&#34; + str(result[1][1]) + \
                        &#34;/&#34; + str(result[1][2]))</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.qr_uuid"><code class="name flex">
<span>def <span class="ident">qr_uuid</span></span>(<span>self, arg, arg2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def qr_uuid(self, arg, arg2):
    uuu = arg2.get_text()
    if not uuu:
        msg = &#34;Please generate UUID first.&#34;
        pymisc.smessage(msg)
        self.status.set_status_text(msg)
        return
    nnn = self.dat_dict[&#39;name&#39;].get_text() + &#34; -- &#34; + \
            self.dat_dict[&#39;dob&#39;].get_text()

    ret = pymisc.QrDlg(uuu, nnn, self.conf, parent = self)</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.reset_changed"><code class="name flex">
<span>def <span class="ident">reset_changed</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>Reset flags for changed dict</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def  reset_changed(self):

    &#39;&#39;&#39; Reset flags for changed dict &#39;&#39;&#39;

    for aa in self.dat_dict.keys():
        self.dat_dict_org[aa] = self.dat_dict[aa].get_text()</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.save_data"><code class="name flex">
<span>def <span class="ident">save_data</span></span>(<span>self, arg1)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def save_data(self, arg1):

    # See if changed
    if not self.is_changed():
        msg = &#34;Nothing changed, cannot save.&#34;
        self.status.set_status_text(msg)
        pymisc.smessage(msg)
        return

    if not self.dat_dict[&#39;name&#39;].get_text():
        msg = &#34;Must have a FULL name.&#34;
        self.status.set_status_text(msg)
        self.set_focus(self.dat_dict[&#39;name&#39;])
        pymisc.smessage(msg)
        return

    dob = self.dat_dict[&#39;dob&#39;].get_text()
    if not dob or len(dob.split(&#34;/&#34;)) &lt; 3:
        msg = &#34;Must have a valid Client date of birth. (yyyy/mm/dd)&#34;
        self.status.set_status_text(msg)
        self.set_focus(self.dat_dict[&#39;dob&#39;])
        pymisc.smessage(msg)
        return

    # Commemorate event by setting a fresh date
    #if  self.dat_dict[&#39;now&#39;].get_text() == &#34;&#34;:
    dd = datetime.datetime.now().replace(microsecond=0)
    self.dat_dict[&#39;now&#39;].set_text(dd.isoformat())

    # This we can generate, but the user better know about it
    # Wed 01.May.2024 Auto generated
    self.autofill(&#39;uuid&#39;, uuid.uuid1())

    # Autofill what we can
    self.autofill(&#39;guid&#39;, self.conf.siteid)
    self.autofill(&#39;ouid&#39;, self.ouid)
    self.autofill(&#39;oper&#39;, self.operator)

    ddd = {}
    for aa in self.dat_dict.keys():
        ddd[aa] = self.dat_dict[aa].get_text()

    pvh = pyvhash.BcData()
    # We mark this as &#39;test&#39; so it can stay in the chain, if desired
    #pvh.addpayload({&#34;Test&#34;: &#34;test&#34; ,})
    pvh.addpayload(ddd)

    def callbdlg(dlg):
        #print(&#34;callback from dlg&#34;)
        self.status.set_status_text(&#34;PROW calc, please wait ...&#34;)
        ddd = 15
        for aa in range(ddd):
            dlg.prog.set_fraction((aa+1) * 1/ddd)
            if pvh.powarr():
                break
            self.status.set_status_text(&#34;PROW calc retry %d ..&#34; % (aa+1))
        dlg.response(Gtk.ResponseType.ACCEPT)
        dlg.destroy()
        self.status.set_status_text(&#34;PROW done.&#34;)

    if self.conf.weak:
        pvh.num_zeros = 1
    dlg = pymisc.progDlg(self.conf, callbdlg, parent = self)

    if not pvh.checkpow():
        msg = &#34;Cold not generate PROW, please retry saving record.&#34;
        pymisc.smessage(msg, conf=self.conf, sound=&#34;error&#34;)
        return

    #print(&#34;Save_data&#34;, pvh.datax)

    enc = self.packer.encode_data(&#34;&#34;, pvh.datax)
    #print(&#34;enc:&#34;, enc)
    uuu = self.dat_dict[&#39;uuid&#39;].get_text()

    # Add index
    def callb(c2, id2):
        # Replicate fields from local data
        dddd = [uuu, enc.encode()]
        #print(&#34;dddd:&#34;, dddd)
        try:
            pyvindex.append_index(c2, self.vcore.hashname,  pyvindex.hash_id, dddd)
        except:
            print(&#34;exc save callb hash&#34;, sys.exc_info())
        try:
            pyvindex.append_index(c2, self.vcore.hashname2, pyvindex.hash_name, dddd)
        except:
            print(&#34;exc save callb name&#34;, sys.exc_info())
            #pgutils.put_exception(&#34;save idx&#34;)
        try:
            pyvindex.append_index(c2, self.vcore.hashname3, pyvindex.hash_email, dddd)
        except:
            print(&#34;exc save callb name&#34;, sys.exc_info())

        try:
            pyvindex.append_index(c2, self.vcore.hashname4, pyvindex.hash_phone, dddd)
        except:
            print(&#34;exc save callb name&#34;, sys.exc_info())

    try:
        self.vcore.postexec = callb
        ret = self.vcore.save_data(uuu, enc)
    except:
        pass
        print(&#34;save&#34;, sys.exc_info())
    finally:
        self.vcore.postexec = None

    if self.conf.playsound:
        self.conf.playsound.play_sound(&#34;shutter&#34;)

    self.status.set_status_text(&#34;Entry &#39;%s&#39; saved.&#34; % self.dat_dict[&#39;name&#39;].get_text())

    for aa in self.dat_dict.keys():
        self.dat_dict_org[aa] = self.dat_dict[aa].get_text()</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.sel_last"><code class="name flex">
<span>def <span class="ident">sel_last</span></span>(<span>self, treex)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def sel_last(self, treex):
    #print(&#34;sel last ...&#34;)
    sel = treex.get_selection()
    xmodel, xiter = sel.get_selected()
    iter = xmodel.get_iter_first()
    if not iter:
        return
    while True:
        iter2 = xmodel.iter_next(iter)
        if not iter2:
            break
        iter = iter2.copy()
    sel.select_iter(iter)
    ppp = xmodel.get_path(iter)
    treex.set_cursor(ppp, self.tree1.get_column(0), False)
    pgutils.usleep(5)
    treex.scroll_to_cell(ppp, None, True, 0., 0. )
    #sel.select_path(self.treestore.get_path(iter))</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.start_pass_dlg"><code class="name flex">
<span>def <span class="ident">start_pass_dlg</span></span>(<span>self, arg2)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def start_pass_dlg(self, arg2):

    authcnt = 0
    while True:
        if authcnt &gt; 3:
            pymisc.smessage(&#34;Too May tries, exiting.&#34;)
            sys.exit(1)
        ret = passdlg.auth_initial(self.authcore, self.packer, self.conf)

        #print(&#34;ret:&#34;, ret)

        if not ret[0]:
            authcnt += 1
            continue

        if ret[1][2] != &#34;Enabled&#34;:
            authcnt += 1
            msg = &#34;Cannot log in, user &#39;%s&#39; is disbled &#34; % ret[1][0]
            self.status.set_status_text(msg)
            pymisc.smessage(msg)
            continue

        # Success
        self.operator = ret[1][0]
        self.powers   = ret[1][4]
        self.ouid     = ret[1][5]
        #print(&#34;pow&#34;, self.powers, self.operator, self.ouid)
        self.status.set_status_text(&#34;Authenticated &#39;%s&#39;&#34; % ret[1][0])
        self.en_dis_all(True)
        pyvrecsel.audit(self.acore, self.packer, &#34;Successful Login&#34;, ret[1][0])
        break
    self.set_focus(self.dat_dict[&#39;name&#39;])</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.test_data"><code class="name flex">
<span>def <span class="ident">test_data</span></span>(<span>self, arg1)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def test_data(self, arg1):

    self.conf.playsound = None
    #print(&#34;test started&#34;)
    self.stop = not self.stop

    if self.reentry:
        self.usleep(100)
        return

    self.reentry = True
    while True:
        if self.exit_flag:
            self.reset_changed()
            break
        if self.stop:
            self.reset_changed()
            self.status.set_status_text(&#34;Test Stopped&#34;)
            break
        for aa in self.dat_dict.keys():
            # Handle differences
            if aa == &#39;uuid&#39;:
               self.dat_dict[aa].set_text(str(uuid.uuid1()) )
            elif aa == &#39;name&#39;:
               self.dat_dict[aa].set_text(pgtests.simname(random.randint(12, 22)))
            elif aa == &#39;guid&#39;:
               self.dat_dict[aa].set_text(str(uuid.uuid1()) )
            elif aa == &#39;dob&#39;:
                self.dat_dict[aa].set_text(pgtests.randate())
            elif aa == &#39;addr1&#39;:
                self.dat_dict[aa].set_text(pgtests.simaddr(18))
            elif aa == &#39;addr2&#39;:
                self.dat_dict[aa].set_text(pgtests.simaddr(12))
            elif aa == &#39;phone&#39;:
                self.dat_dict[aa].set_text(pgtests.randphone())
            elif aa == &#39;phone2&#39;:
                self.dat_dict[aa].set_text(pgtests.randphone())
            elif aa == &#39;email&#39;:
                self.dat_dict[aa].set_text(pgtests.randemail())
            elif aa == &#39;email2&#39;:
                self.dat_dict[aa].set_text(pgtests.randemail())
            elif aa == &#39;zip&#39;:
                self.dat_dict[aa].set_text(pgtests.randnumstr(5))
            elif aa == &#39;now&#39;:
                self.dat_dict[aa].set_text(pgtests.randisodate())
            elif aa == &#39;notes&#39;:
                self.dat_dict[aa].set_text(pgtests.randascii(random.randint(33, 66)))
            else:
                self.dat_dict[aa].set_text(pgtests.randstr(random.randint(6, 22)))
        sleepx = 20
        pgutils.usleep(sleepx)
        self.save_data(0)
        self.clear_data()
        pgutils.usleep(sleepx)
    self.reentry = False</code></pre>
</details>
</dd>
<dt id="mainwinpeople.MainWin.wrap"><code class="name flex">
<span>def <span class="ident">wrap</span></span>(<span>self, cont)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def wrap(self, cont):
    fr = Gtk.Frame()
    sc = Gtk.ScrolledWindow()
    sc.set_hexpand(True)
    sc.set_vexpand(True)
    sc.add(cont)
    fr.add(sc)
    return fr, cont</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="mainwinpeople.MainWin" href="#mainwinpeople.MainWin">MainWin</a></code></h4>
<ul class="two-column">
<li><code><a title="mainwinpeople.MainWin.OnExit" href="#mainwinpeople.MainWin.OnExit">OnExit</a></code></li>
<li><code><a title="mainwinpeople.MainWin.activate_about" href="#mainwinpeople.MainWin.activate_about">activate_about</a></code></li>
<li><code><a title="mainwinpeople.MainWin.activate_action" href="#mainwinpeople.MainWin.activate_action">activate_action</a></code></li>
<li><code><a title="mainwinpeople.MainWin.activate_exit" href="#mainwinpeople.MainWin.activate_exit">activate_exit</a></code></li>
<li><code><a title="mainwinpeople.MainWin.activate_quit" href="#mainwinpeople.MainWin.activate_quit">activate_quit</a></code></li>
<li><code><a title="mainwinpeople.MainWin.autofill" href="#mainwinpeople.MainWin.autofill">autofill</a></code></li>
<li><code><a title="mainwinpeople.MainWin.button_press_event" href="#mainwinpeople.MainWin.button_press_event">button_press_event</a></code></li>
<li><code><a title="mainwinpeople.MainWin.cellx" href="#mainwinpeople.MainWin.cellx">cellx</a></code></li>
<li><code><a title="mainwinpeople.MainWin.clear_data" href="#mainwinpeople.MainWin.clear_data">clear_data</a></code></li>
<li><code><a title="mainwinpeople.MainWin.config_dlg" href="#mainwinpeople.MainWin.config_dlg">config_dlg</a></code></li>
<li><code><a title="mainwinpeople.MainWin.del_data" href="#mainwinpeople.MainWin.del_data">del_data</a></code></li>
<li><code><a title="mainwinpeople.MainWin.en_dis_all" href="#mainwinpeople.MainWin.en_dis_all">en_dis_all</a></code></li>
<li><code><a title="mainwinpeople.MainWin.exit_all" href="#mainwinpeople.MainWin.exit_all">exit_all</a></code></li>
<li><code><a title="mainwinpeople.MainWin.is_changed" href="#mainwinpeople.MainWin.is_changed">is_changed</a></code></li>
<li><code><a title="mainwinpeople.MainWin.key_press_event" href="#mainwinpeople.MainWin.key_press_event">key_press_event</a></code></li>
<li><code><a title="mainwinpeople.MainWin.load_data" href="#mainwinpeople.MainWin.load_data">load_data</a></code></li>
<li><code><a title="mainwinpeople.MainWin.load_op_name" href="#mainwinpeople.MainWin.load_op_name">load_op_name</a></code></li>
<li><code><a title="mainwinpeople.MainWin.load_op_uuid" href="#mainwinpeople.MainWin.load_op_uuid">load_op_uuid</a></code></li>
<li><code><a title="mainwinpeople.MainWin.load_site_uuid" href="#mainwinpeople.MainWin.load_site_uuid">load_site_uuid</a></code></li>
<li><code><a title="mainwinpeople.MainWin.load_uuid" href="#mainwinpeople.MainWin.load_uuid">load_uuid</a></code></li>
<li><code><a title="mainwinpeople.MainWin.main" href="#mainwinpeople.MainWin.main">main</a></code></li>
<li><code><a title="mainwinpeople.MainWin.new_data" href="#mainwinpeople.MainWin.new_data">new_data</a></code></li>
<li><code><a title="mainwinpeople.MainWin.non_changed" href="#mainwinpeople.MainWin.non_changed">non_changed</a></code></li>
<li><code><a title="mainwinpeople.MainWin.pressed_dob" href="#mainwinpeople.MainWin.pressed_dob">pressed_dob</a></code></li>
<li><code><a title="mainwinpeople.MainWin.qr_uuid" href="#mainwinpeople.MainWin.qr_uuid">qr_uuid</a></code></li>
<li><code><a title="mainwinpeople.MainWin.reset_changed" href="#mainwinpeople.MainWin.reset_changed">reset_changed</a></code></li>
<li><code><a title="mainwinpeople.MainWin.save_data" href="#mainwinpeople.MainWin.save_data">save_data</a></code></li>
<li><code><a title="mainwinpeople.MainWin.sel_last" href="#mainwinpeople.MainWin.sel_last">sel_last</a></code></li>
<li><code><a title="mainwinpeople.MainWin.start_pass_dlg" href="#mainwinpeople.MainWin.start_pass_dlg">start_pass_dlg</a></code></li>
<li><code><a title="mainwinpeople.MainWin.test_data" href="#mainwinpeople.MainWin.test_data">test_data</a></code></li>
<li><code><a title="mainwinpeople.MainWin.wrap" href="#mainwinpeople.MainWin.wrap">wrap</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>